---
title: 存储器
comments: false
date: 2019-02-20 17:35:06
tag: 
    - 计算机原理
    - 存储器	
categories:
    - 系统工程师考试归纳
---
# 存取器系统  
## 定义  
- **存储器：**用于存放程序和数据的部件，是一个记忆装置，是计算机实现“存储程序控制”的基础。
- 规模较大的存储器往往分成若干级，称为**存储器系统**。
## 局部性原理  
程序在执行时呈现出局部性规律，即在一较短的时间内，程序的执行仅局限于某个部分。相应地，它所访问的存储空间也仅局限于某个区域。  
程序局部性包括**时间局部性**和**空间局部性**。  
**时间局部性：** 指程序中的某条指令一旦执行，不久以后该指令可能再次执行。产生时间局部性的典型原因是由于程序中存在着大量的循环操作；  
**空间局部性：** 指一旦程序访问了某个存储单元，不久以后，其附近的存储单元也将被访问，即程序在一段时间内所访问的地址可能集中在一定的范围内，其典型情况是程序顺序执行。   

## 分类  

|**对应硬件**|存取方式|容量|读取速度|分类|
|:-:|:--:|:------:|:-----:|:-:|
|**CAM**|相联存取|小|快|Cache|
|**SRAM**|随机存取|小|快|主存（主存储器）|
|**DRAM**|随机存取|小|快|主存（主存储器）|
|**ROM**|随机存取|小|快|主存（主存储器）|
|**硬盘**|直接存取|大|慢|辅存（辅助存储器）|
|**磁带**|顺序存取|大|慢|辅存（辅助存储器）|

### P.S. 特殊说明  
1.  **Cache**的存在是为了解决主存和CPU速度不匹配；用于快速提供指令和数据。  
2. **RAM**（Random Access Memory ）分为 DRAM（Dynamic RAM）和SRAM（Static RAM）；  
3. **ROM**是**RAM**的特殊形式，只能随机读出而不能写入 ；断点内容不会丢失，信息一旦写入不可修改。  
### DRAM & SRAM  
**DRAM：** 信息会随时间逐渐消失，因此需要定时对其进行刷新维持信息不丢失。  
**SRAM：** 在不断电的情况下信息能够一直保持而不会丢失。     

**比较：**

| 标题 | 密度 |         速度         | 价格 |
| :--: | :--: | :------------------: | :--: |
| DRAM |  大  |          慢          |  低  |
| SRAM |  小  | 快（不需要刷星电路） |  高  |

## 内存编址  
### 定义  
**内存编址**：  
​	存储器由一块块的空间（存储单元）组成，为了方便寻找到每一块空间，我们需要对每一个空间进行标识。  
**芯片：**  
​	存储器由若干个芯片构成，一个芯片中有若干个存储单位。  
**存储器容量 = 芯片容量 × 芯片个数**   
**芯片容量 = 一个地址的容量 × 编址总数**    
### 编址方式  
#### 字编址：  
同数据总线长度，一般为32bit，64bit。  
#### 字节编址：  
一字节为8bit。  
#### 比特  
比特为bit，是一个正负单位。  

## 磁带  
一种顺序存取的设备，其特点包括：存取时间较长，但存储容量大，便于携带，价格便宜。磁带应用的场景越来越少，目前主要用于资料的归档保存。   

## 硬盘  
硬盘存储器的信息分布层次为：记录面，圆柱面，磁道，扇区。  
每个盘片有两个记录面，每个记录面对应一个磁头。所以记录面号就是磁头号。  
![硬盘主体](/../../../images/系统工程师/计算机原理/存储器/硬盘主体.png)  
最外圈磁道为0号，往内依次增加。  
通常将一条磁道划分为若干个段，每个段称为一个扇区或扇段，每个扇区存放一个定长
信息块（例如， 512 个字节） ；  
扇区的编号从1开始。  

![硬盘扇区](/../../../images/系统工程师/计算机原理/存储器/硬盘扇区.png)  

每个磁盘片有 m 个磁道，则该硬盘共有 m 个柱面 。  
![硬盘柱面](/../../../images/系统工程师/计算机原理/存储器/硬盘柱面.png)  

### 大文件存储策略

引入柱面概念是为了提高硬盘的存储速度。

当主机要存入一个较大的文件时，若一条磁道存不完，就需要存放在几条磁道上。这时，应首先将一个文件尽可能地存放在同一柱面中。如果仍存放不完，再存入相邻的柱面内。 



### 存取时间  
**寻道：**  
在磁盘上进行信息的读写时，首先需要定位到目标磁道，这个过程称之为寻道；  

**寻道时间：**  
寻道所消耗的时间称 ；  

**旋转延时：**  
定位到目标磁道后，需要定位到目标扇区，此过程通过旋转盘片完成，平均旋转半圈可到目标位置 ；  

**公式：**  
磁盘访问时间（存取时间） = 寻道时间 + 旋转延迟时间   



## Cache  

大多数 RISC 采用了 Cache 方案，使用 Cache 来提高取指令的速度。而且，有的 RISC使用两个独立的 Cache 来改善性能。一个称为指令 Cache，另一个称为数据 Cache。这样，取指令和取数据可以同时进行，互不干扰。

### CAM  
相联存储器（ContentAddressable Memory， CAM），一种基于数据内容进行访问的存储设备。  
当对其写入数据时， CAM 能够自动选择一个未用的空单元进行存储；  
当要读出数据时，不是给出其存储单元的地址，而是直接给出该数据或者该数据的一部分内容， CAM 对所有存储单元中的数据同时进行比较，并标记符合条件的所有数据以供读取。  
由于比较是同时、并行进行的，所以，这种基于数据内容进行读写的机制，其速度比基于地址进行读写的方式要快很多。  

### Cache命中率

以 **h** 代表对 Cache 的访问命中率（“1-h”称为失效率，或者称为未命中率）  
**t1** 表示 cache 的周期时间  
**t2** 表示内存的周期时间，  
以读操作为例，使用“ Cache+主存储器”的系统的平均周期为 **t3**。  
则：  
**t3 =t1′ h+t2′ (1-h) **  


### 映射机制  
当 CPU 发出访存请求后，存储器地址先被送到 Cache 控制器以确定所需数据是否已  
在 Cache 中，若命中则直接对 Cache 进行访问。这个过程称为 Cache 的地址映射（映像）。  
在 Cache 的地址映射中，主存和 Cache 将均分成容量相同的块（页）。  

例：映像条件
内存容量为 1GB， Cache 容量为 8MB，页面的大小为 512KB。  

#### 直接映像 
主存地址被分成三个部分：区号、页号、页内地址；  
直接映像中，先分区，再分页。一个区的大小就是 Cache 容量的大小，  
所以一共分：   
1GB/8MB=128 个区，区号 7 位。  

每个区分：

 8MB/512KB=16 个页，所以页号为 4 位。  
![映射-直接映射-地址](/../../../images/系统工程师/计算机原理/存储器/映射-直接映射-地址.png)

每个主存页只能复制到某一固定的 Cache 页中；  
**直接映像方式的映像规律是：** 主存中每个区的第 0 页，只能进入到 Cache 的第 0 页。  
即：
若当前时刻 Cache 中 0 号页已被占据，而 1-15 号页空闲，现在要将 1 区第 0 页（即内
存的 16 页）调入 Cache 是会发生冲突的。所以直接映像的块冲突率非常高。 

**优点** ：比较容易实现  
**缺点** ：不够灵活，有可能使 Cache 的存储空间得不到充分利用。

![映射-直接映射-示意](/../../../images/系统工程师/计算机原理/存储器/映射-直接映射-示意.png)



#### 全相联映像   
主存地址分为两个部分，分别为地址部分（主存页标记）和数据部分（页内地址）。  
数据部分用于存放数据，而地址部分则存放该数据的存储器地址。   

每个 Cache 页可映像到 2048 个主存页中的任一页，所以每页的Cache 标记也需要 11 位，以表明它现在所映像的主存页号。因此， Cache 标记信息位数增加，比较逻辑成本随之增加。

![映射-全相联映射-地址](/../../../images/系统工程师/计算机原理/存储器/映射-全相联映射-地址.png)  


在全相联映像方式中，主存地址不能直接提取 Cache 页号，而是需要将主存页标记与Cache 各页的标记逐个比较，直到找到标记符合的页（访问 Cache 命中），或者全部比较完后仍无符合的标记（访问 Cache 失败）。因此这种映像方式速度很慢，失掉了高速缓存的作用，这是全相联映像方式的最大缺点。  
如果让主存页标记与各 Cache 标记同时比较，则成本又太高。全相联映像方式因比较器电路难于设计和实现，只适用于小容量 Cache。  

![映射-全相联映射-示意](/../../../images/系统工程师/计算机原理/存储器/映射-全相联映射-示意.png)


#### 组相联映像 

组相联映像（页组映像）介于直接映像和全相联映像之间，是这两种映像的一种折衷方案。全相联映像方式以页为单位，可自由映像，没有固定的对应关系。直接映像方式中，主存分组，主存组内的各页与 Cache 的页之间采取的是固定的映像关系，但各组均可映像到Cache 中。在组相联映像方式中，主存与 Cache 都分组，主存中一个组内的页数与 Cache 的分组数相同；

例中：  
主存分 128 个区，每个区 8 个组，每个组 2 个页。组相联映像方式的主存地址组织：  
![映射-组相联映射-地址](/../../../images/系统工程师/计算机原理/存储器/映射-组相联映射-地址.png)  

组相联映像的规则是：主存中的组与 Cache 的组形成直接映像关系，而每个组内的页是全相联映像关系。如主存 1 区 0 页，他在 0 组中，所以只能进入 Cache 的 0 组中，至于进入到 Cache 的 0 组 0 页，还是 0 组 1 页，并无强制要求，可任意放置。

在组相联映像中， Cache 中每一页的标记位长度为 8 位，因为此时除了要记录区号，还得记录组号，即区号 7 位加组号 1 位等于 8 位。  

容易看出，如果 Cache 中每组只有一页，则组相联映像方式就变成了直接映像方式。如果 Cache 中每组页数为 16 页（即 Cache 只分一组），则就是全相联映像。因此，在具体设计组相联映像时，可以根据设计目标选取某一折衷值。  

在组相联映像中，由于 Cache 中每组有若干可供选择的页，因而它在映像定位方面较直接映像方式灵活； 

每组页数有限，因此付出的代价不是很大，可以根据设计目标选择组内页数。

![映射-组相联映射-示意](/../../../images/系统工程师/计算机原理/存储器/映射-组相联映射-示意.png)

### 替换算法  
当 Cache 产生了一次访问未命中之后，相应的数据应同时读入 CPU 和 Cache。但是当Cache 已存满数据后，新数据必须替换（淘汰） Cache 中的某些旧数据。最常用的替换算法有以下三种：

>（1）随机算法。这是最简单的替换算法。随机法完全不管 Cache 块过去、现在及将来的使用情况，简单地根据一个随机数，选择一块替换掉。

>（2）先进先出（First In and First Out， FIFO）算法。按调入 Cache 的先后决定淘汰的顺序，即在需要更新时，将最先进入 Cache 的块作为被替换的块。这种方法要求为每块做一记录，记下它们进入 ache 的先后次序。这种方法容易实现，而且系统开销小。其缺点是可能会把一些需要经常使用的程序块（如循环程序）替换掉。

>（3）近期最少使用（Least Recently Used， LRU）算法。 LRU 算法是把 CPU 近期最少使用的块作为被替换的块。这种替换方法需要随时记录 Cache 中各块的使用情况，以便确定哪个块是近期最少使用的块。 LRU 算法相对合理，但实现起来比较复杂，系统开销较大。通常需要对每一块设置一个称为“年龄计数器”的硬件或软件计数器，用以记录其被使用的情况。

### 写操作
因为需要保证缓存在 Cache 中的数据与内存中的内容一致，相对读操作而言， Cache 的写操作比较复杂，常用的有以下几种方法。

>（1）写直达（write through）。当要写 Cache 时，数据同时写回内存，有时也称为写通。当某一块需要替换时，也不必把这一块写回到主存中去，新调入的块可以立即把这一块覆盖掉。这种方法实现简单，而且能随时保持主存数据的正确性，但可能增加多次不必要的主存写入，会降低存取速度。

>（2）写回（write back）。 CPU 修改 Cache 的某一块后，相应的数据并不立即写入内存单元，而是当该块从 cache 中被淘汰时，才把数据写回到内存中。在采用这种更新策略的cache 块表中，一般有一个标志位，当一块中的任何一个单元被修改时，标志位被置“1”。在需要替换掉这一块时，如果标志位为“1”，则必须先把这一块写回到主存中去之后，才能再调入新的块；如果标志位为“0”，则这一块不必写回主存，只要用新调入的块覆盖掉这一块即可。这种方法的优点是操作速度快，缺点是因主存中的字块未随时修改而有可能出错。

>（3）标记法。对 Cache 中的每一个数据设置一个有效位。当数据进入 Cache 后，有效位置“1”；而当 CPU 要对该数据进行修改时，数据只需写入内存并同时将该有效位置“0”。当要从 Cache 中读取数据时需要测试其有效位，若为“l”则直接从 Cache 中取数，否则，从内存中取数。