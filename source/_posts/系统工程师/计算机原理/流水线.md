---
title: 流水线
comments: false
date: 2019-02-21 15:45:13
tag: 
    - 计算机原理
    - 流水线
categories:
    - 系统工程师考试归纳
mathjax: true
---
# 流水线

**原理：**  
计算机的任务中，存在大量相同任务的执行。  
把一个任务分解为若干顺序执行的子任务，不同的子任务由不同的执行机构负责执行，而这些机构可以同时并行工作。
在任一时刻，任一任务只占用其中一个执行机构，这样就可以实现多个任务的重叠执行，以提高工作效率。

## 流水线周期
流水线过程分为**N**个阶段，最耗时的那段为**流水线周期**。

## 流水线执行时间计算
>**1** 个任务的执行过程可分成 **N** 个阶段，假设每个阶段完成时间为 **t**，则完成该任务所需的时间即为 **Nt**。若以传统的方式，则完成 **k** 个任务所需的时间是 **kNt**；而使用流水线技术执行，且花费的时间是 **Nt+(k-1)t**。也就是说，除了第 **1** 个任务需要完整的时间外，其他都通过并行，节省下了大量的时间。

**执行时间理论值：**  

**流水线执行时间 = 一条指令执行的时间 +（总任务数-1）× 流水线周期**

在实际中，真正做流水线处理时，考虑到处理的复杂性，会将指令的每个执行阶段的时间都统一为流水线周期。

**执行时间实际值：**  

**流水线执行时间 = 拆分的子任务数 × 流水线周期 +（总任务数-1）× 流水线周期**  



## 流水线吞吐率

流水线的吞吐率（Though Put rate， TP）是指在单位时间内流水线所完成的任务数量或输出的结果数量。

基本公式： 

$$
TP = \frac{n}{T_k}
$$

**n**  为任务数，**Tk** 为处理完 **n** 个任务用的时间。

$$
TP_{max} = \lim_{n \to \infty} \frac{n}{(k + n - 1)t} = \frac{1}{t}
$$
**t** 位平均时间。



## 流水线加速比
在流水线中，因为在同一时刻，有多个任务在重叠地执行，虽然完成一个任务的时间与单独执行该任务相近（甚至由于分段的缘故，可能更多一些），但是从整体上看完成多个任务所需的时间则大大减少。

完成同样一批任务，不使用流水线所用的时间与使用流水线所用的时间之比称为流水线的加速比（speedup ratio）。

如果不使用流水线，即顺序执行所用的时间为 **T0** ，使用流水线的执行时间为 **Tk** ，则计算流水线加速比的基本公式如下：
$$
S = \frac{T_o}{T_k}
$$
如果流水线各个流水段的执行时间都相等（设为 **Dt** ），则一条 **k** 段流水线完成  **n ** 个连 续任务所需要的时间为 **(k+n-1)Dt** 。如果不使用流水线，即顺序执行这  **n**  个任务，则所需要的时间为 **nkDt** 。因此，各个流水段执行时间均相等的一条  **k**  段流水线完成 **n** 个连续任务 时的实际加速比为 :

**t** 位平均时间:
$$
S = \frac{nkt}{(k+n-1)t} = \frac{nk}{k+n-1}
$$
则最大加速比：
$$
S_{max} = \lim_{n \to \infty} \frac{nk}{k+n-1} = k
$$
