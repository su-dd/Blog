<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>CMake详解 | 苏呆呆的博客</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_3077305_pt8umhrn4k9.css">
    <script>var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?3d63e1b0aa607833cafb451888226547";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();</script>
    <script async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" data-ad-client="ca-pub-2770102725717150" crossorigin="anonymous"></script>
    <meta name="description" content="一个向往美好生活的笨人。">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta name="keywords" content="su-dd,苏呆呆,苏呆呆的博客,呆呆的博客,个人技术博客,技术文档,c++基础,c++提高,c11,c++新特性,c++,java,spring,ddd,面向对象,设计模式,汇编,git,springcloud,面试,git,github,markdown,md文档,vdoing,demo">
    <meta name="theme-color" content="#11a8cd">
    <meta name="baidu_union_verify" content="0c4ba741a75f427faa8dd9c724a81b73">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    
    <link rel="preload" href="/assets/css/0.styles.a6635593.css" as="style"><link rel="preload" href="/assets/js/app.b2b0617d.js" as="script"><link rel="preload" href="/assets/js/2.cff562a5.js" as="script"><link rel="preload" href="/assets/js/40.238ee8ee.js" as="script"><link rel="preload" href="/assets/js/8.7397f135.js" as="script"><link rel="prefetch" href="/assets/js/10.2cd4b68b.js"><link rel="prefetch" href="/assets/js/100.60b800ef.js"><link rel="prefetch" href="/assets/js/101.66701792.js"><link rel="prefetch" href="/assets/js/102.c3b3591c.js"><link rel="prefetch" href="/assets/js/103.92e4ddd8.js"><link rel="prefetch" href="/assets/js/104.691282f2.js"><link rel="prefetch" href="/assets/js/105.c5599995.js"><link rel="prefetch" href="/assets/js/106.af3edb3d.js"><link rel="prefetch" href="/assets/js/107.c25e9863.js"><link rel="prefetch" href="/assets/js/108.1e3aeebe.js"><link rel="prefetch" href="/assets/js/109.1b22a6eb.js"><link rel="prefetch" href="/assets/js/11.733d4ab2.js"><link rel="prefetch" href="/assets/js/110.d40a1bca.js"><link rel="prefetch" href="/assets/js/111.c3ea7452.js"><link rel="prefetch" href="/assets/js/112.d96e8508.js"><link rel="prefetch" href="/assets/js/113.658cb11a.js"><link rel="prefetch" href="/assets/js/114.381756eb.js"><link rel="prefetch" href="/assets/js/115.41cc8435.js"><link rel="prefetch" href="/assets/js/116.05139cac.js"><link rel="prefetch" href="/assets/js/117.963900c8.js"><link rel="prefetch" href="/assets/js/118.37965514.js"><link rel="prefetch" href="/assets/js/119.823c0b39.js"><link rel="prefetch" href="/assets/js/12.f5a70e82.js"><link rel="prefetch" href="/assets/js/120.d3655be7.js"><link rel="prefetch" href="/assets/js/121.7e3815cd.js"><link rel="prefetch" href="/assets/js/122.dd04ca2c.js"><link rel="prefetch" href="/assets/js/123.5eec9a72.js"><link rel="prefetch" href="/assets/js/124.92a29444.js"><link rel="prefetch" href="/assets/js/125.63e42c6a.js"><link rel="prefetch" href="/assets/js/126.55a1d374.js"><link rel="prefetch" href="/assets/js/127.1beb1614.js"><link rel="prefetch" href="/assets/js/128.99051007.js"><link rel="prefetch" href="/assets/js/129.beb99217.js"><link rel="prefetch" href="/assets/js/13.4d8c1284.js"><link rel="prefetch" href="/assets/js/130.329d962a.js"><link rel="prefetch" href="/assets/js/131.59b74420.js"><link rel="prefetch" href="/assets/js/132.fce7d641.js"><link rel="prefetch" href="/assets/js/133.21a55328.js"><link rel="prefetch" href="/assets/js/134.c43d0376.js"><link rel="prefetch" href="/assets/js/135.ea174984.js"><link rel="prefetch" href="/assets/js/136.be318aaa.js"><link rel="prefetch" href="/assets/js/137.d84d5582.js"><link rel="prefetch" href="/assets/js/138.4b34b72b.js"><link rel="prefetch" href="/assets/js/139.df5ea758.js"><link rel="prefetch" href="/assets/js/14.518510ed.js"><link rel="prefetch" href="/assets/js/140.0d57d5ab.js"><link rel="prefetch" href="/assets/js/141.4a719260.js"><link rel="prefetch" href="/assets/js/142.6753af99.js"><link rel="prefetch" href="/assets/js/143.ba256a59.js"><link rel="prefetch" href="/assets/js/144.a7ebd62e.js"><link rel="prefetch" href="/assets/js/145.a27410d5.js"><link rel="prefetch" href="/assets/js/146.ca494a45.js"><link rel="prefetch" href="/assets/js/147.6fdefa7e.js"><link rel="prefetch" href="/assets/js/148.71fb2e90.js"><link rel="prefetch" href="/assets/js/149.a8a7065d.js"><link rel="prefetch" href="/assets/js/15.a266a355.js"><link rel="prefetch" href="/assets/js/150.90099809.js"><link rel="prefetch" href="/assets/js/151.71bb788d.js"><link rel="prefetch" href="/assets/js/152.6ec0f3e3.js"><link rel="prefetch" href="/assets/js/153.3790a3de.js"><link rel="prefetch" href="/assets/js/154.152c7b24.js"><link rel="prefetch" href="/assets/js/155.bfa10f50.js"><link rel="prefetch" href="/assets/js/156.d3e6f6a6.js"><link rel="prefetch" href="/assets/js/157.93423f96.js"><link rel="prefetch" href="/assets/js/158.193f485f.js"><link rel="prefetch" href="/assets/js/159.b1fe6678.js"><link rel="prefetch" href="/assets/js/16.69ecfe5a.js"><link rel="prefetch" href="/assets/js/160.971bd865.js"><link rel="prefetch" href="/assets/js/161.15f6e202.js"><link rel="prefetch" href="/assets/js/162.fe071dc9.js"><link rel="prefetch" href="/assets/js/163.da0876dc.js"><link rel="prefetch" href="/assets/js/164.c6a447f0.js"><link rel="prefetch" href="/assets/js/165.fc7a3304.js"><link rel="prefetch" href="/assets/js/166.203d55bb.js"><link rel="prefetch" href="/assets/js/17.a6a5e59d.js"><link rel="prefetch" href="/assets/js/18.8c9e44cc.js"><link rel="prefetch" href="/assets/js/19.2861a5bd.js"><link rel="prefetch" href="/assets/js/20.dabdcc5e.js"><link rel="prefetch" href="/assets/js/21.b8317130.js"><link rel="prefetch" href="/assets/js/22.46e9b7da.js"><link rel="prefetch" href="/assets/js/23.a4025da6.js"><link rel="prefetch" href="/assets/js/24.c2fbd549.js"><link rel="prefetch" href="/assets/js/25.30472c64.js"><link rel="prefetch" href="/assets/js/26.442945fd.js"><link rel="prefetch" href="/assets/js/27.4a086f9b.js"><link rel="prefetch" href="/assets/js/28.edf89f24.js"><link rel="prefetch" href="/assets/js/29.151226bf.js"><link rel="prefetch" href="/assets/js/3.531acd57.js"><link rel="prefetch" href="/assets/js/30.6c067212.js"><link rel="prefetch" href="/assets/js/31.bb1540d1.js"><link rel="prefetch" href="/assets/js/32.09f5cc25.js"><link rel="prefetch" href="/assets/js/33.5261d5ea.js"><link rel="prefetch" href="/assets/js/34.51c795e3.js"><link rel="prefetch" href="/assets/js/35.12f7f988.js"><link rel="prefetch" href="/assets/js/36.8327db33.js"><link rel="prefetch" href="/assets/js/37.112f6c0b.js"><link rel="prefetch" href="/assets/js/38.20191ba3.js"><link rel="prefetch" href="/assets/js/39.e45a5efd.js"><link rel="prefetch" href="/assets/js/4.917e5a2f.js"><link rel="prefetch" href="/assets/js/41.be9bf62e.js"><link rel="prefetch" href="/assets/js/42.3a4f56b4.js"><link rel="prefetch" href="/assets/js/43.92f23c09.js"><link rel="prefetch" href="/assets/js/44.e5053632.js"><link rel="prefetch" href="/assets/js/45.52ab3b68.js"><link rel="prefetch" href="/assets/js/46.c2589849.js"><link rel="prefetch" href="/assets/js/47.102e88ad.js"><link rel="prefetch" href="/assets/js/48.bf524334.js"><link rel="prefetch" href="/assets/js/49.0f9ffe85.js"><link rel="prefetch" href="/assets/js/5.323082ce.js"><link rel="prefetch" href="/assets/js/50.43cb2571.js"><link rel="prefetch" href="/assets/js/51.976889fe.js"><link rel="prefetch" href="/assets/js/52.118f8b22.js"><link rel="prefetch" href="/assets/js/53.06a3f5cd.js"><link rel="prefetch" href="/assets/js/54.493670ce.js"><link rel="prefetch" href="/assets/js/55.0a6a171b.js"><link rel="prefetch" href="/assets/js/56.36041806.js"><link rel="prefetch" href="/assets/js/57.3abb2bd6.js"><link rel="prefetch" href="/assets/js/58.9c30f62c.js"><link rel="prefetch" href="/assets/js/59.f5e92ffb.js"><link rel="prefetch" href="/assets/js/6.fba4ebfe.js"><link rel="prefetch" href="/assets/js/60.14f8e778.js"><link rel="prefetch" href="/assets/js/61.f555540c.js"><link rel="prefetch" href="/assets/js/62.e596fc73.js"><link rel="prefetch" href="/assets/js/63.0c349e67.js"><link rel="prefetch" href="/assets/js/64.dd07a2e6.js"><link rel="prefetch" href="/assets/js/65.315a6949.js"><link rel="prefetch" href="/assets/js/66.1c5ded71.js"><link rel="prefetch" href="/assets/js/67.494d92bb.js"><link rel="prefetch" href="/assets/js/68.aef647d2.js"><link rel="prefetch" href="/assets/js/69.45bd65a7.js"><link rel="prefetch" href="/assets/js/7.45101e24.js"><link rel="prefetch" href="/assets/js/70.06c91bba.js"><link rel="prefetch" href="/assets/js/71.b8aece77.js"><link rel="prefetch" href="/assets/js/72.7cf0f3d3.js"><link rel="prefetch" href="/assets/js/73.f49fdd95.js"><link rel="prefetch" href="/assets/js/74.5a806d23.js"><link rel="prefetch" href="/assets/js/75.91f2b41a.js"><link rel="prefetch" href="/assets/js/76.1db73a7f.js"><link rel="prefetch" href="/assets/js/77.39aa2f0f.js"><link rel="prefetch" href="/assets/js/78.dcd5cc8e.js"><link rel="prefetch" href="/assets/js/79.df14cf99.js"><link rel="prefetch" href="/assets/js/80.2b3b8b9f.js"><link rel="prefetch" href="/assets/js/81.80345e8a.js"><link rel="prefetch" href="/assets/js/82.ed95ca0d.js"><link rel="prefetch" href="/assets/js/83.335e4184.js"><link rel="prefetch" href="/assets/js/84.b219dc4b.js"><link rel="prefetch" href="/assets/js/85.9d032788.js"><link rel="prefetch" href="/assets/js/86.55f210e6.js"><link rel="prefetch" href="/assets/js/87.a0db9e8f.js"><link rel="prefetch" href="/assets/js/88.b3537c8a.js"><link rel="prefetch" href="/assets/js/89.33570411.js"><link rel="prefetch" href="/assets/js/9.20fcb649.js"><link rel="prefetch" href="/assets/js/90.941c4684.js"><link rel="prefetch" href="/assets/js/91.be607e5a.js"><link rel="prefetch" href="/assets/js/92.f0d5e953.js"><link rel="prefetch" href="/assets/js/93.b8937166.js"><link rel="prefetch" href="/assets/js/94.b252b8a4.js"><link rel="prefetch" href="/assets/js/95.8af820f5.js"><link rel="prefetch" href="/assets/js/96.9dcd0ab0.js"><link rel="prefetch" href="/assets/js/97.9699c160.js"><link rel="prefetch" href="/assets/js/98.e1d14407.js"><link rel="prefetch" href="/assets/js/99.eb86b749.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a6635593.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="苏呆呆的博客" class="logo"> <span class="site-name can-hide">苏呆呆的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程语言" class="dropdown-title"><a href="/language/" class="link-title">编程语言</a> <span class="title" style="display:none;">编程语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/language/c++/" class="nav-link">C++</a></li><li class="dropdown-item"><!----> <a href="/language/java/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/language/go/" class="nav-link">Go</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="软件设计" class="dropdown-title"><a href="/design/" class="link-title">软件设计</a> <span class="title" style="display:none;">软件设计</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/design/oo/" class="nav-link">面向对象</a></li><li class="dropdown-item"><!----> <a href="/design/GoF/" class="nav-link">设计模式</a></li><li class="dropdown-item"><!----> <a href="/design/ddd/" class="nav-link">领域驱动设计</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常用框架" class="dropdown-title"><a href="/frame/" class="link-title">常用框架</a> <span class="title" style="display:none;">常用框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frame/spring/" class="nav-link">Spring</a></li></ul></div></div><div class="nav-item"><a href="/tools/" class="nav-link">常用工具</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/archives/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>本站</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-subitem"><a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-subitem"><a href="/archives/" class="nav-link">归档</a></li></ul></li><li class="dropdown-item"><h4>我的</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/about/" class="nav-link">关于</a></li><li class="dropdown-subitem"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></li></ul></li></ul></div></div> <a href="https://github.com/su-dd/blogwriter" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.addai.cn/blog/网站使用/呆呆.webp"> <div class="blogger-info"><h3>苏呆呆</h3> <span>一个向往美好生活的笨人。</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程语言" class="dropdown-title"><a href="/language/" class="link-title">编程语言</a> <span class="title" style="display:none;">编程语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/language/c++/" class="nav-link">C++</a></li><li class="dropdown-item"><!----> <a href="/language/java/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/language/go/" class="nav-link">Go</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="软件设计" class="dropdown-title"><a href="/design/" class="link-title">软件设计</a> <span class="title" style="display:none;">软件设计</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/design/oo/" class="nav-link">面向对象</a></li><li class="dropdown-item"><!----> <a href="/design/GoF/" class="nav-link">设计模式</a></li><li class="dropdown-item"><!----> <a href="/design/ddd/" class="nav-link">领域驱动设计</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常用框架" class="dropdown-title"><a href="/frame/" class="link-title">常用框架</a> <span class="title" style="display:none;">常用框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frame/spring/" class="nav-link">Spring</a></li></ul></div></div><div class="nav-item"><a href="/tools/" class="nav-link">常用工具</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/archives/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>本站</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-subitem"><a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-subitem"><a href="/archives/" class="nav-link">归档</a></li></ul></li><li class="dropdown-item"><h4>我的</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/about/" class="nav-link">关于</a></li><li class="dropdown-subitem"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></li></ul></li></ul></div></div> <a href="https://github.com/su-dd/blogwriter" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>CMake</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/6a3b4c/" class="sidebar-link">CMake简述</a></li><li><a href="/pages/44f8a2/" aria-current="page" class="active sidebar-link">CMake详解</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/44f8a2/#什么是-cmake" class="sidebar-link">什么是 CMake?</a></li><li class="sidebar-sub-header level2"><a href="/pages/44f8a2/#入门案例-单个源文件" class="sidebar-link">入门案例：单个源文件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/44f8a2/#编写-cmakelists-txt" class="sidebar-link">编写 CMakeLists.txt</a></li><li class="sidebar-sub-header level3"><a href="/pages/44f8a2/#编译项目" class="sidebar-link">编译项目</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/44f8a2/#多个源文件" class="sidebar-link">多个源文件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/44f8a2/#同一目录-多个源文件" class="sidebar-link">同一目录，多个源文件</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/44f8a2/#多个目录-多个源文件" class="sidebar-link">多个目录，多个源文件</a></li><li class="sidebar-sub-header level2"><a href="/pages/44f8a2/#自定义编译选项" class="sidebar-link">自定义编译选项</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/44f8a2/#修改-cmakelists-文件" class="sidebar-link">修改 CMakeLists 文件</a></li><li class="sidebar-sub-header level3"><a href="/pages/44f8a2/#修改-main-cc-文件" class="sidebar-link">修改 main.cc 文件</a></li><li class="sidebar-sub-header level3"><a href="/pages/44f8a2/#编写-config-h-in-文件" class="sidebar-link">编写 config.h.in 文件</a></li><li class="sidebar-sub-header level3"><a href="/pages/44f8a2/#编译项目-2" class="sidebar-link">编译项目</a></li><li class="sidebar-sub-header level3"><a href="/pages/44f8a2/#use-mymath-为-on" class="sidebar-link">USE_MYMATH 为 ON</a></li><li class="sidebar-sub-header level3"><a href="/pages/44f8a2/#use-mymath-为-off" class="sidebar-link">USE_MYMATH 为 OFF</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/44f8a2/#安装和测试" class="sidebar-link">安装和测试</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/44f8a2/#定制安装规则" class="sidebar-link">定制安装规则</a></li><li class="sidebar-sub-header level3"><a href="/pages/44f8a2/#为工程添加测试" class="sidebar-link">为工程添加测试</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/44f8a2/#支持-gdb" class="sidebar-link">支持 gdb</a></li><li class="sidebar-sub-header level2"><a href="/pages/44f8a2/#添加环境检查" class="sidebar-link">添加环境检查</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/44f8a2/#添加-checkfunctionexists-宏" class="sidebar-link">添加 CheckFunctionExists 宏</a></li><li class="sidebar-sub-header level3"><a href="/pages/44f8a2/#预定义相关宏变量" class="sidebar-link">预定义相关宏变量</a></li><li class="sidebar-sub-header level3"><a href="/pages/44f8a2/#在代码中使用宏和函数" class="sidebar-link">在代码中使用宏和函数</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/44f8a2/#添加版本号" class="sidebar-link">添加版本号</a></li><li class="sidebar-sub-header level2"><a href="/pages/44f8a2/#生成安装包" class="sidebar-link">生成安装包</a></li><li class="sidebar-sub-header level2"><a href="/pages/44f8a2/#项目迁移" class="sidebar-link">项目迁移</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/44f8a2/#autotools" class="sidebar-link">autotools</a></li><li class="sidebar-sub-header level3"><a href="/pages/44f8a2/#qmake" class="sidebar-link">qmake</a></li><li class="sidebar-sub-header level3"><a href="/pages/44f8a2/#visual-studio" class="sidebar-link">Visual Studio</a></li><li class="sidebar-sub-header level3"><a href="/pages/44f8a2/#cmakelists-txt-自动推导" class="sidebar-link">CMakeLists.txt 自动推导</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/44f8a2/#类似工具" class="sidebar-link">类似工具</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>NVM</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>部署</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/tools/#常用工具" data-v-06225672>常用工具</a></li><li data-v-06225672><a href="/tools/#CMake" data-v-06225672>CMake</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/su-dd" target="_blank" title="作者" class="beLink" data-v-06225672>su-dd</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-04-03</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">CMake详解<!----></h1>  <div class="theme-vdoing-content content__default"><h2 id="什么是-cmake"><a href="#什么是-cmake" class="header-anchor">#</a> 什么是 CMake?</h2> <p>你或许听过好几种 <code>Make</code> 工具，例如 <code>GNU Make</code> ，QT 的 <code>qmake</code> ，微软的 <code>MS nmake</code>，<code>BSD Make</code>（<code>pmake</code>），<code>Makepp</code>，等等。</p> <p>这些 <code>Make</code> 工具遵循着不同的规范和标准，所执行的 <code>Makefile</code> 格式也千差万别。这样就带来了一个严峻的问题：如果软件想跨平台，必须要保证能够在不同平台编译。而如果使用上面的 <code>Make</code> 工具，就得为每一种标准写一次 <code>Makefile</code> ，这将是一件让人抓狂的工作。</p> <p><code>CMake</code> 就是针对上面问题所设计的工具：它首先允许开发者编写一种平台无关的 <code>CMakeList.txt</code> 文件来定制整个编译流程，然后再根据目标用户的平台进一步生成所需的本地化 <code>Makefile</code> 和工程文件，如 <code>Unix</code> 的 <code>Makefile</code> 或 <code>Windows</code> 的 Visual Studio 工程。</p> <p>从而做到 <strong>“Write once, run everywhere”</strong>。</p> <p>显然，<code>CMake</code> 是一个比上述几种 <code>make</code> 更高级的编译配置工具。一些使用 <code>CMake</code> 作为项目架构系统的知名开源项目有 <code>VTK</code>、<code>ITK</code>、<code>KDE</code>、<code>OpenCV</code>、<code>OSG</code> 等 [1]。在 linux 平台下使用 <code>CMake</code> 生成 <code>Makefile</code> 并编译的流程如下：</p> <p>写 <code>CMake</code> 配置文件 <code>CMakeLists.txt</code> 。
执行命令 <code>cmake PATH</code> 或者 <code>ccmake PATH</code> 生成 <code>Makefile</code>（<code>ccmake</code>和 <code>cmake</code> 的区别在于前者提供了一个交互式的界面）。其中， <code>PATH</code> 是 <code>CMakeLists.txt</code> 所在的目录。
使用 <code>make</code> 命令进行编译。</p> <h2 id="入门案例-单个源文件"><a href="#入门案例-单个源文件" class="header-anchor">#</a> 入门案例：单个源文件</h2> <p>本节对应的源代码所在目录：</p> <p><a href="https://github.com/wzpan/cmake-demo/tree/master/Demo1" target="_blank" rel="noopener noreferrer">https://github.com/wzpan/cmake-demo/tree/master/Demo1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>对于简单的项目，只需要写几行代码就可以了。例如，假设现在我们的项目中只有一个源文件 main.cc ，该程序的用途是计算一个数的指数幂。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>

<span class="token comment">/**
 * power - Calculate the power of number.
 * @param base: Base value.
 * @param exponent: Exponent value.
 *
 * @return base raised to the power exponent.
 */</span>
<span class="token keyword">double</span> <span class="token function">power</span><span class="token punctuation">(</span><span class="token keyword">double</span> base<span class="token punctuation">,</span> <span class="token keyword">int</span> exponent<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> result <span class="token operator">=</span> base<span class="token punctuation">;</span>
    <span class="token keyword">int</span> i<span class="token punctuation">;</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span>exponent <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> exponent<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">{</span>
        result <span class="token operator">=</span> result <span class="token operator">*</span> base<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>argc <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Usage: %s base exponent \n&quot;</span><span class="token punctuation">,</span> argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">double</span> base <span class="token operator">=</span> <span class="token function">atof</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> exponent <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">double</span> result <span class="token operator">=</span> <span class="token function">power</span><span class="token punctuation">(</span>base<span class="token punctuation">,</span> exponent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%g ^ %d is %g\n&quot;</span><span class="token punctuation">,</span> base<span class="token punctuation">,</span> exponent<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><h3 id="编写-cmakelists-txt"><a href="#编写-cmakelists-txt" class="header-anchor">#</a> 编写 CMakeLists.txt</h3> <p>首先编写 CMakeLists.txt 文件，并保存在与 main.cc 源文件同个目录下：</p> <div class="language-cmake line-numbers-mode"><pre class="language-cmake"><code><span class="token comment"># CMake 最低版本号要求</span>
<span class="token keyword">cmake_minimum_required</span> <span class="token punctuation">(</span><span class="token property">VERSION</span> <span class="token number">2.8</span><span class="token punctuation">)</span>

<span class="token comment"># 项目信息</span>
<span class="token keyword">project</span> <span class="token punctuation">(</span>Demo1<span class="token punctuation">)</span>

<span class="token comment"># 指定生成目标</span>
<span class="token keyword">add_executable</span><span class="token punctuation">(</span>Demo main.cc<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><code>CMakeLists.txt</code> 的语法比较简单，由命令、注释和空格组成，其中命令是不区分大小写的。</p> <p>符号 <code>#</code> 后面的内容被认为是注释。命令由命令名称、小括号和参数组成，参数之间使用空格进行间隔。</p> <p>对于上面的 <code>CMakeLists.txt</code> 文件，依次出现了几个命令：</p> <p><strong>cmake_minimum_required</strong>：指定运行此配置文件所需的 <code>CMake</code> 的最低版本；
<strong>project</strong>：参数值是 <code>Demo1</code>，该命令表示项目的名称是 <code>Demo1</code> 。
<strong>add_executable</strong>：将名为 <code>main.cc</code> 的源文件编译成一个名称为 <code>Demo</code> 的可执行文件。</p> <h3 id="编译项目"><a href="#编译项目" class="header-anchor">#</a> 编译项目</h3> <p>之后，在当前目录执行 <code>cmake .</code> ，得到 <code>Makefile</code> 后再使用 <code>make</code> 命令编译得到 <code>Demo1</code> 可执行文件。</p> <div class="language-cmd line-numbers-mode"><pre class="language-text"><code>[ehome@xman Demo1]$ cmake .
-- The C compiler identification is GNU 4.8.2
-- The CXX compiler identification is GNU 4.8.2
-- Check for working C compiler: /usr/sbin/cc
-- Check for working C compiler: /usr/sbin/cc -- works
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - done
-- Check for working CXX compiler: /usr/sbin/c++
-- Check for working CXX compiler: /usr/sbin/c++ -- works
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - done
-- Configuring done
-- Generating done
-- Build files have been written to: /home/ehome/Documents/programming/C/power/Demo1
[ehome@xman Demo1]$ make
Scanning dependencies of target Demo
[100%] Building C object CMakeFiles/Demo.dir/main.cc.o
Linking C executable Demo
[100%] Built target Demo
[ehome@xman Demo1]$ ./Demo 5 4
5 ^ 4 is 625
[ehome@xman Demo1]$ ./Demo 7 3
7 ^ 3 is 343
[ehome@xman Demo1]$ ./Demo 2 10
2 ^ 10 is 1024
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h2 id="多个源文件"><a href="#多个源文件" class="header-anchor">#</a> 多个源文件</h2> <h3 id="同一目录-多个源文件"><a href="#同一目录-多个源文件" class="header-anchor">#</a> 同一目录，多个源文件</h3> <p>本小节对应的源代码所在目录：</p> <p><a href="https://github.com/wzpan/cmake-demo/tree/master/Demo2" target="_blank" rel="noopener noreferrer">https://github.com/wzpan/cmake-demo/tree/master/Demo2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>上面的例子只有单个源文件。现在假如把 <code>power</code> 函数单独写进一个名为 <code>MathFunctions.c</code> 的源文件里，使得这个工程变成如下的形式：</p> <div class="language-txt line-numbers-mode"><pre class="language-txt"><code>./Demo2
    |
    +--- main.cc
    |
    +--- MathFunctions.cc
    |
    +--- MathFunctions.h
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>这个时候，<code>CMakeLists.txt</code> 可以改成如下的形式：</p> <div class="language-cmake line-numbers-mode"><pre class="language-cmake"><code><span class="token comment"># CMake 最低版本号要求</span>
<span class="token keyword">cmake_minimum_required</span> <span class="token punctuation">(</span><span class="token property">VERSION</span> <span class="token number">2.8</span><span class="token punctuation">)</span>

<span class="token comment"># 项目信息</span>
<span class="token keyword">project</span> <span class="token punctuation">(</span>Demo2<span class="token punctuation">)</span>

<span class="token comment"># 指定生成目标</span>
<span class="token keyword">add_executable</span><span class="token punctuation">(</span>Demo main.cc MathFunctions.cc<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>唯一的改动只是在 <code>add_executable</code> 命令中增加了一个 <code>MathFunctions.cc</code> 源文件。</p> <p>这样写当然没什么问题，但是如果源文件很多，把所有源文件的名字都加进去将是一件烦人的工作。更省事的方法是使用 <code>aux_source_directory</code> 命令，该命令会查找指定目录下的所有源文件，然后将结果存进指定变量名。其语法如下：</p> <div class="language-cmake line-numbers-mode"><pre class="language-cmake"><code><span class="token keyword">aux_source_directory</span><span class="token punctuation">(</span>&lt;dir<span class="token punctuation">&gt;</span> &lt;variable<span class="token punctuation">&gt;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>因此，可以修改 <code>CMakeLists.txt</code> 如下：</p> <div class="language-cmake line-numbers-mode"><pre class="language-cmake"><code><span class="token comment"># CMake 最低版本号要求</span>
<span class="token keyword">cmake_minimum_required</span> <span class="token punctuation">(</span><span class="token property">VERSION</span> <span class="token number">2.8</span><span class="token punctuation">)</span>

<span class="token comment"># 项目信息</span>
<span class="token keyword">project</span> <span class="token punctuation">(</span>Demo2<span class="token punctuation">)</span>

<span class="token comment"># 查找当前目录下的所有源文件</span>
<span class="token comment"># 并将名称保存到 DIR_SRCS 变量</span>
<span class="token keyword">aux_source_directory</span><span class="token punctuation">(</span>. DIR_SRCS<span class="token punctuation">)</span>

<span class="token comment"># 指定生成目标</span>
<span class="token keyword">add_executable</span><span class="token punctuation">(</span>Demo <span class="token punctuation">${</span>DIR_SRCS<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>这样，<code>CMake</code> 会将当前目录所有源文件的文件名赋值给变量 <code>DIR_SRCS</code> ，再指示变量 <code>DIR_SRCS</code> 中的源文件需要编译成一个名称为 <code>Demo</code> 的可执行文件。</p> <h2 id="多个目录-多个源文件"><a href="#多个目录-多个源文件" class="header-anchor">#</a> 多个目录，多个源文件</h2> <p>本小节对应的源代码所在目录：</p> <p><a href="https://github.com/wzpan/cmake-demo/tree/master/Demo3" target="_blank" rel="noopener noreferrer">https://github.com/wzpan/cmake-demo/tree/master/Demo3<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>现在进一步将 <code>MathFunctions.h</code> 和 <code>MathFunctions.cc</code> 文件移动到 math 目录下。</p> <div class="language-txt line-numbers-mode"><pre class="language-txt"><code>./Demo3
    |
    +--- main.cc
    |
    +--- math/
          |
          +--- MathFunctions.cc
          |
          +--- MathFunctions.h
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>对于这种情况，需要分别在项目根目录 <code>Demo3</code> 和 <code>math</code> 目录里各编写一个 <code>CMakeLists.txt</code>文件。</p> <p>为了方便，我们可以先将 <code>math</code> 目录里的文件编译成静态库再由 main 函数调用。</p> <p>根目录中的 <code>CMakeLists.txt</code> ：</p> <div class="language-cmake line-numbers-mode"><pre class="language-cmake"><code><span class="token comment"># CMake 最低版本号要求</span>
<span class="token keyword">cmake_minimum_required</span> <span class="token punctuation">(</span><span class="token property">VERSION</span> <span class="token number">2.8</span><span class="token punctuation">)</span>

<span class="token comment"># 项目信息</span>
<span class="token keyword">project</span> <span class="token punctuation">(</span>Demo3<span class="token punctuation">)</span>

<span class="token comment"># 查找当前目录下的所有源文件</span>
<span class="token comment"># 并将名称保存到 DIR_SRCS 变量</span>
<span class="token keyword">aux_source_directory</span><span class="token punctuation">(</span>. DIR_SRCS<span class="token punctuation">)</span>

<span class="token comment"># 添加 math 子目录</span>
<span class="token keyword">add_subdirectory</span><span class="token punctuation">(</span>math<span class="token punctuation">)</span>

<span class="token comment"># 指定生成目标 </span>
<span class="token keyword">add_executable</span><span class="token punctuation">(</span>Demo main.cc<span class="token punctuation">)</span>

<span class="token comment"># 添加链接库</span>
<span class="token keyword">target_link_libraries</span><span class="token punctuation">(</span>Demo MathFunctions<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>该文件添加了下面的内容: 第3行，使用命令 <code>add_subdirectory</code> 指明本项目包含一个子目录 <code>math</code>，这样 <code>math</code> 目录下的 <code>CMakeLists.txt</code> 文件和源代码也会被处理 。</p> <p>第6行，使用命令 <code>target_link_libraries</code> 指明可执行文件 <code>main</code> 需要连接一个名为 <code>MathFunctions</code> 的链接库 。</p> <p>子目录中的 <code>CMakeLists.txt</code>：</p> <div class="language-cmake line-numbers-mode"><pre class="language-cmake"><code><span class="token comment"># 查找当前目录下的所有源文件</span>
<span class="token comment"># 并将名称保存到 DIR_LIB_SRCS 变量</span>
<span class="token keyword">aux_source_directory</span><span class="token punctuation">(</span>. DIR_LIB_SRCS<span class="token punctuation">)</span>

<span class="token comment"># 生成链接库</span>
<span class="token keyword">add_library</span> <span class="token punctuation">(</span>MathFunctions <span class="token punctuation">${</span>DIR_LIB_SRCS<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>在该文件中使用命令 <code>add_library</code> 将 <code>src</code> 目录中的源文件编译为静态链接库。</p> <h2 id="自定义编译选项"><a href="#自定义编译选项" class="header-anchor">#</a> 自定义编译选项</h2> <p>本节对应的源代码所在目录：</p> <p><a href="https://github.com/wzpan/cmake-demo/tree/master/Demo4" target="_blank" rel="noopener noreferrer">https://github.com/wzpan/cmake-demo/tree/master/Demo4<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><code>CMake</code> 允许为项目增加编译选项，从而可以根据用户的环境和需求选择最合适的编译方案。例如，可以将 <code>MathFunctions</code> 库设为一个可选的库，如果该选项为 <code>ON</code> ，就使用该库定义的数学函数来进行运算。否则就调用标准库中的数学函数库。</p> <h3 id="修改-cmakelists-文件"><a href="#修改-cmakelists-文件" class="header-anchor">#</a> 修改 CMakeLists 文件</h3> <p>我们要做的第一步是在顶层的 CMakeLists.txt 文件中添加该选项：</p> <div class="language-cmake line-numbers-mode"><pre class="language-cmake"><code><span class="token comment"># CMake 最低版本号要求</span>
<span class="token keyword">cmake_minimum_required</span> <span class="token punctuation">(</span><span class="token property">VERSION</span> <span class="token number">2.8</span><span class="token punctuation">)</span>

<span class="token comment"># 项目信息</span>
<span class="token keyword">project</span> <span class="token punctuation">(</span>Demo4<span class="token punctuation">)</span>

<span class="token comment"># 加入一个配置头文件，用于处理 CMake 对源码的设置</span>
<span class="token keyword">configure_file</span> <span class="token punctuation">(</span>
  <span class="token string">&quot;<span class="token interpolation"><span class="token punctuation">${</span><span class="token variable">PROJECT_SOURCE_DIR</span><span class="token punctuation">}</span></span>/config.h.in&quot;</span>
  <span class="token string">&quot;<span class="token interpolation"><span class="token punctuation">${</span><span class="token variable">PROJECT_BINARY_DIR</span><span class="token punctuation">}</span></span>/config.h&quot;</span>
  <span class="token punctuation">)</span>

<span class="token comment"># 是否使用自己的 MathFunctions 库</span>
<span class="token keyword">option</span> <span class="token punctuation">(</span>USE_MYMATH
       <span class="token string">&quot;Use provided math implementation&quot;</span> <span class="token boolean">ON</span><span class="token punctuation">)</span>

<span class="token comment"># 是否加入 MathFunctions 库</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>USE_MYMATH<span class="token punctuation">)</span>
  <span class="token keyword">include_directories</span> <span class="token punctuation">(</span><span class="token string">&quot;<span class="token interpolation"><span class="token punctuation">${</span><span class="token variable">PROJECT_SOURCE_DIR</span><span class="token punctuation">}</span></span>/math&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">add_subdirectory</span> <span class="token punctuation">(</span>math<span class="token punctuation">)</span>  
  <span class="token keyword">set</span> <span class="token punctuation">(</span>EXTRA_LIBS <span class="token punctuation">${</span>EXTRA_LIBS<span class="token punctuation">}</span> MathFunctions<span class="token punctuation">)</span>
<span class="token keyword">endif</span> <span class="token punctuation">(</span>USE_MYMATH<span class="token punctuation">)</span>

<span class="token comment"># 查找当前目录下的所有源文件</span>
<span class="token comment"># 并将名称保存到 DIR_SRCS 变量</span>
<span class="token keyword">aux_source_directory</span><span class="token punctuation">(</span>. DIR_SRCS<span class="token punctuation">)</span>

<span class="token comment"># 指定生成目标</span>
<span class="token keyword">add_executable</span><span class="token punctuation">(</span>Demo <span class="token punctuation">${</span>DIR_SRCS<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">target_link_libraries</span> <span class="token punctuation">(</span>Demo  <span class="token punctuation">${</span>EXTRA_LIBS<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>其中：</p> <p>第7行的 <code>configure_file</code> 命令用于加入一个配置头文件 <code>config.h</code> ，这个文件由 <code>CMake</code> 从 <code>config.h.in</code> 生成，通过这样的机制，将可以通过预定义一些参数和变量来控制代码的生成。
第13行的 <code>option</code> 命令添加了一个 <code>USE_MYMATH</code> 选项，并且默认值为 <code>ON</code> 。
第17行根据 <code>USE_MYMATH</code> 变量的值来决定是否使用我们自己编写的 <code>MathFunctions</code> 库。</p> <h3 id="修改-main-cc-文件"><a href="#修改-main-cc-文件" class="header-anchor">#</a> 修改 main.cc 文件</h3> <p>之后修改 main.cc 文件，让其根据 <code>USE_MYMATH</code> 的预定义值来决定是否调用标准库还是 MathFunctions 库：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;config.h&quot;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">USE_MYMATH</span></span>
  <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;math/MathFunctions.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span>
  <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;math.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>


<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>argc <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Usage: %s base exponent \n&quot;</span><span class="token punctuation">,</span> argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">double</span> base <span class="token operator">=</span> <span class="token function">atof</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> exponent <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">USE_MYMATH</span></span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Now we use our own Math library. \n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">double</span> result <span class="token operator">=</span> <span class="token function">power</span><span class="token punctuation">(</span>base<span class="token punctuation">,</span> exponent<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Now we use the standard library. \n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">double</span> result <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span>base<span class="token punctuation">,</span> exponent<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%g ^ %d is %g\n&quot;</span><span class="token punctuation">,</span> base<span class="token punctuation">,</span> exponent<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h3 id="编写-config-h-in-文件"><a href="#编写-config-h-in-文件" class="header-anchor">#</a> 编写 config.h.in 文件</h3> <p>上面的程序值得注意的是第2行，这里引用了一个 <code>config.h</code> 文件，这个文件预定义了 <code>USE_MYMATH</code> 的值。但我们并不直接编写这个文件，为了方便从 <code>CMakeLists.txt</code> 中导入配置，我们编写一个 <code>config.h.in</code> 文件，内容如下：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">cmakedefine</span> <span class="token expression">USE_MYMATH</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这样 <code>CMake</code> 会自动根据 <code>CMakeLists</code> 配置文件中的设置自动生成 <code>config.h</code> 文件。</p> <h3 id="编译项目-2"><a href="#编译项目-2" class="header-anchor">#</a> 编译项目</h3> <p>现在编译一下这个项目，为了便于交互式的选择该变量的值，可以使用 <code>ccmake</code> 命令（也可以使用 <code>cmake -i</code> 命令，该命令会提供一个会话式的交互式配置界面）：</p> <p><img src="https://pic2.zhimg.com/v2-d796be171c8fd08b017403f9df999455_r.jpg" alt=""></p> <p><code>CMake</code>的交互式配置界面
<code>CMake</code>的交互式配置界面从中可以找到刚刚定义的 <code>USE_MYMATH</code> 选项，按键盘的方向键可以在不同的选项窗口间跳转，按下 <code>enter</code> 键可以修改该选项。修改完成后可以按下 c 选项完成配置，之后再按 <code>g</code> 键确认生成 <code>Makefile</code> <code>。ccmake</code> 的其他操作可以参考窗口下方给出的指令提示。我们可以试试分别将 <code>USE_MYMATH</code> 设为 <code>ON</code> 和 <code>OFF</code> 得到的结果：</p> <h3 id="use-mymath-为-on"><a href="#use-mymath-为-on" class="header-anchor">#</a> <code>USE_MYMATH</code> 为 <code>ON</code></h3> <p>运行结果：</p> <div class="language-cmd line-numbers-mode"><pre class="language-text"><code>[ehome@xman Demo4]$ ./Demo
Now we use our own MathFunctions library. 
 7 ^ 3 = 343.000000
 10 ^ 5 = 100000.000000
 2 ^ 10 = 1024.000000
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>此时 <code>config.h</code> 的内容为：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#define USE_MYMATH
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="use-mymath-为-off"><a href="#use-mymath-为-off" class="header-anchor">#</a> <code>USE_MYMATH</code> 为 <code>OFF</code></h3> <p>运行结果：</p> <div class="language-cmd line-numbers-mode"><pre class="language-text"><code>[ehome@xman Demo4]$ ./Demo
Now we use the standard library. 
 7 ^ 3 = 343.000000
 10 ^ 5 = 100000.000000
 2 ^ 10 = 1024.000000
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>此时 config.h 的内容为：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">/* #undef USE_MYMATH */</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="安装和测试"><a href="#安装和测试" class="header-anchor">#</a> 安装和测试</h2> <p>本节对应的源代码所在目录：</p> <p><a href="https://github.com/wzpan/cmake-demo/tree/master/Demo5" target="_blank" rel="noopener noreferrer">https://github.com/wzpan/cmake-demo/tree/master/Demo5<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><code>CMake</code> 也可以指定安装规则，以及添加测试。这两个功能分别可以通过在产生 <code>Makefile</code> 后使用 <code>make install</code> 和 <code>make test</code> 来执行。在以前的 <code>GNU Makefile</code> 里，你可能需要为此编写 <code>install</code> 和 <code>test</code> 两个伪目标和相应的规则，但在 <code>CMake</code> 里，这样的工作同样只需要简单的调用几条命令。</p> <h3 id="定制安装规则"><a href="#定制安装规则" class="header-anchor">#</a> 定制安装规则</h3> <p>首先先在<code>math/CMakeLists.txt</code> 文件里添加下面两行：</p> <div class="language-cmake line-numbers-mode"><pre class="language-cmake"><code><span class="token comment"># 指定 MathFunctions 库的安装路径</span>
<span class="token keyword">install</span> <span class="token punctuation">(</span>TARGETS MathFunctions DESTINATION bin<span class="token punctuation">)</span>
<span class="token keyword">install</span> <span class="token punctuation">(</span>FILES MathFunctions.h DESTINATION include<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>指明 MathFunctions 库的安装路径。之后同样修改根目录的 <code>CMakeLists</code> 文件，在末尾添加下面几行：</p> <div class="language-cmake line-numbers-mode"><pre class="language-cmake"><code><span class="token comment"># 指定安装路径</span>
<span class="token keyword">install</span> <span class="token punctuation">(</span>TARGETS Demo DESTINATION bin<span class="token punctuation">)</span>
<span class="token keyword">install</span> <span class="token punctuation">(</span>FILES <span class="token string">&quot;<span class="token interpolation"><span class="token punctuation">${</span><span class="token variable">PROJECT_BINARY_DIR</span><span class="token punctuation">}</span></span>/config.h&quot;</span>
         DESTINATION include<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>通过上面的定制，生成的 <code>Demo</code> 文件和 <code>MathFunctions</code> 函数库 <code>libMathFunctions.o</code> 文件将会被复制到 <code>/usr/local/bin</code> 中，而 <code>MathFunctions.h</code> 和生成的 <code>config.h</code> 文件则会被复制到 <code>/usr/local/include</code> 中。</p> <p>我们可以验证一下（顺带一提的是，这里的 <code>/usr/local/</code> 是默认安装到的根目录，可以通过修改 <code>CMAKE_INSTALL_PREFIX</code> 变量的值来指定这些文件应该拷贝到哪个根目录）：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[ehome@xman Demo5]$ sudo make install
[ 50%] Built target MathFunctions
[100%] Built target Demo
Install the project...
-- Install configuration: &quot;&quot;
-- Installing: /usr/local/bin/Demo
-- Installing: /usr/local/include/config.h
-- Installing: /usr/local/bin/libMathFunctions.a
-- Up-to-date: /usr/local/include/MathFunctions.h
[ehome@xman Demo5]$ ls /usr/local/bin
Demo  libMathFunctions.a
[ehome@xman Demo5]$ ls /usr/local/include
config.h  MathFunctions.h
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="为工程添加测试"><a href="#为工程添加测试" class="header-anchor">#</a> 为工程添加测试</h3> <p>添加测试同样很简单。CMake 提供了一个称为 CTest 的测试工具。我们要做的只是在项目根目录的 CMakeLists 文件中调用一系列的 add_test 命令。</p> <div class="language-cmake line-numbers-mode"><pre class="language-cmake"><code><span class="token comment"># 启用测试</span>
<span class="token keyword">enable_testing</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 测试程序是否成功运行</span>
<span class="token keyword">add_test</span> <span class="token punctuation">(</span>test_run Demo <span class="token number">5</span> <span class="token number">2</span><span class="token punctuation">)</span>

<span class="token comment"># 测试帮助信息是否可以正常提示</span>
<span class="token keyword">add_test</span> <span class="token punctuation">(</span>test_usage Demo<span class="token punctuation">)</span>
<span class="token keyword">set_tests_properties</span> <span class="token punctuation">(</span>test_usage
  <span class="token namespace">PROPERTIES</span> <span class="token property">PASS_REGULAR_EXPRESSION</span> <span class="token string">&quot;Usage: .* base exponent&quot;</span><span class="token punctuation">)</span>

<span class="token comment"># 测试 5 的平方</span>
<span class="token keyword">add_test</span> <span class="token punctuation">(</span>test_5_2 Demo <span class="token number">5</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">set_tests_properties</span> <span class="token punctuation">(</span>test_5_2
 <span class="token namespace">PROPERTIES</span> <span class="token property">PASS_REGULAR_EXPRESSION</span> <span class="token string">&quot;is 25&quot;</span><span class="token punctuation">)</span>

<span class="token comment"># 测试 10 的 5 次方</span>
<span class="token keyword">add_test</span> <span class="token punctuation">(</span>test_10_5 Demo <span class="token number">10</span> <span class="token number">5</span><span class="token punctuation">)</span>
<span class="token keyword">set_tests_properties</span> <span class="token punctuation">(</span>test_10_5
 <span class="token namespace">PROPERTIES</span> <span class="token property">PASS_REGULAR_EXPRESSION</span> <span class="token string">&quot;is 100000&quot;</span><span class="token punctuation">)</span>

<span class="token comment"># 测试 2 的 10 次方</span>
<span class="token keyword">add_test</span> <span class="token punctuation">(</span>test_2_10 Demo <span class="token number">2</span> <span class="token number">10</span><span class="token punctuation">)</span>
<span class="token keyword">set_tests_properties</span> <span class="token punctuation">(</span>test_2_10
 <span class="token namespace">PROPERTIES</span> <span class="token property">PASS_REGULAR_EXPRESSION</span> <span class="token string">&quot;is 1024&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>上面的代码包含了四个测试。第一个测试 <code>test_run</code> 用来测试程序是否成功运行并返回 0 值。剩下的三个测试分别用来测试 5 的 平方、10 的 5 次方、2 的 10 次方是否都能得到正确的结果。其中 <code>PASS_REGULAR_EXPRESSION</code> 用来测试输出是否包含后面跟着的字符串。让我们看看测试的结果：</p> <div class="language-cmd line-numbers-mode"><pre class="language-text"><code>[ehome@xman Demo5]$ make test
Running tests...
Test project /home/ehome/Documents/programming/C/power/Demo5
    Start 1: test_run
1/4 Test #1: test_run .........................   Passed    0.00 sec
    Start 2: test_5_2
2/4 Test #2: test_5_2 .........................   Passed    0.00 sec
    Start 3: test_10_5
3/4 Test #3: test_10_5 ........................   Passed    0.00 sec
    Start 4: test_2_10
4/4 Test #4: test_2_10 ........................   Passed    0.00 sec

100% tests passed, 0 tests failed out of 4

Total Test time (real) =   0.01 sec
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>如果要测试更多的输入数据，像上面那样一个个写测试用例未免太繁琐。这时可以通过编写宏来实现：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code># 定义一个宏，用来简化测试工作
<span class="token function">macro</span> <span class="token punctuation">(</span>do_test arg1 arg2 result<span class="token punctuation">)</span>
  <span class="token function">add_test</span> <span class="token punctuation">(</span>test_$<span class="token punctuation">{</span>arg1<span class="token punctuation">}</span>_$<span class="token punctuation">{</span>arg2<span class="token punctuation">}</span> Demo $<span class="token punctuation">{</span>arg1<span class="token punctuation">}</span> $<span class="token punctuation">{</span>arg2<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">set_tests_properties</span> <span class="token punctuation">(</span>test_$<span class="token punctuation">{</span>arg1<span class="token punctuation">}</span>_$<span class="token punctuation">{</span>arg2<span class="token punctuation">}</span>
    PROPERTIES PASS_REGULAR_EXPRESSION $<span class="token punctuation">{</span>result<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">endmacro</span> <span class="token punctuation">(</span>do_test<span class="token punctuation">)</span>
 
# 使用该宏进行一系列的数据测试
<span class="token function">do_test</span> <span class="token punctuation">(</span><span class="token number">5</span> <span class="token number">2</span> <span class="token string">&quot;is 25&quot;</span><span class="token punctuation">)</span>
<span class="token function">do_test</span> <span class="token punctuation">(</span><span class="token number">10</span> <span class="token number">5</span> <span class="token string">&quot;is 100000&quot;</span><span class="token punctuation">)</span>
<span class="token function">do_test</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token number">10</span> <span class="token string">&quot;is 1024&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>关于 <code>CTest</code> 的更详细的用法可以通过 <code>man 1 ctest</code> 参考 CTest 的文档。</p> <h2 id="支持-gdb"><a href="#支持-gdb" class="header-anchor">#</a> 支持 gdb</h2> <p>让 <code>CMake</code> 支持 <code>gdb</code> 的设置也很容易，只需要指定 <code>Debug</code> 模式下开启 <code>-g</code> 选项：</p> <div class="language-cmake line-numbers-mode"><pre class="language-cmake"><code><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token variable">CMAKE_BUILD_TYPE</span> <span class="token string">&quot;Debug&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">set</span><span class="token punctuation">(</span><span class="token variable">CMAKE_CXX_FLAGS_DEBUG</span> <span class="token string">&quot;$ENV{CXXFLAGS} -O0 -Wall -g -ggdb&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">set</span><span class="token punctuation">(</span><span class="token variable">CMAKE_CXX_FLAGS_RELEASE</span> <span class="token string">&quot;$ENV{CXXFLAGS} -O3 -Wall&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>之后可以直接对生成的程序使用 gdb 来调试。</p> <h2 id="添加环境检查"><a href="#添加环境检查" class="header-anchor">#</a> 添加环境检查</h2> <p>本节对应的源代码所在目录：</p> <p><a href="https://github.com/wzpan/cmake-demo/tree/master/Demo6" target="_blank" rel="noopener noreferrer">https://github.com/wzpan/cmake-demo/tree/master/Demo6<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>有时候可能要对系统环境做点检查，例如要使用一个平台相关的特性的时候。在这个例子中，我们检查系统是否自带 <code>pow</code> 函数。如果带有 <code>pow</code> 函数，就使用它；否则使用我们定义的 <code>power</code> 函数。</p> <h3 id="添加-checkfunctionexists-宏"><a href="#添加-checkfunctionexists-宏" class="header-anchor">#</a> 添加 CheckFunctionExists 宏</h3> <p>首先在顶层 CMakeLists 文件中添加 CheckFunctionExists.cmake 宏，并调用 check_function_exists 命令测试链接器是否能够在链接阶段找到 pow 函数。</p> <div class="language-cmake line-numbers-mode"><pre class="language-cmake"><code><span class="token comment"># 检查系统是否支持 pow 函数</span>
<span class="token keyword">include</span> <span class="token punctuation">(</span><span class="token punctuation">${</span><span class="token variable">CMAKE_ROOT</span><span class="token punctuation">}</span>/Modules/CheckFunctionExists.cmake<span class="token punctuation">)</span>
<span class="token function">check_function_exists</span> <span class="token punctuation">(</span>pow HAVE_POW<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>将上面这段代码放在 configure_file 命令前。</p> <h3 id="预定义相关宏变量"><a href="#预定义相关宏变量" class="header-anchor">#</a> 预定义相关宏变量</h3> <p>接下来修改 config.h.in 文件，预定义相关的宏变量。</p> <div class="language-cmake line-numbers-mode"><pre class="language-cmake"><code>// does the platform provide pow function?
<span class="token comment">#cmakedefine HAVE_POW</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="在代码中使用宏和函数"><a href="#在代码中使用宏和函数" class="header-anchor">#</a> 在代码中使用宏和函数</h3> <p>最后一步是修改 main.cc ，在代码中使用宏和函数：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">HAVE_POW</span></span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Now we use the standard library. \n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">double</span> result <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span>base<span class="token punctuation">,</span> exponent<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Now we use our own Math library. \n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">double</span> result <span class="token operator">=</span> <span class="token function">power</span><span class="token punctuation">(</span>base<span class="token punctuation">,</span> exponent<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="添加版本号"><a href="#添加版本号" class="header-anchor">#</a> 添加版本号</h2> <p>本节对应的源代码所在目录：</p> <p><a href="https://github.com/wzpan/cmake-demo/tree/master/Demo7" target="_blank" rel="noopener noreferrer">https://github.com/wzpan/cmake-demo/tree/master/Demo7<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>给项目添加和维护版本号是一个好习惯，这样有利于用户了解每个版本的维护情况，并及时了解当前所用的版本是否过时，或是否可能出现不兼容的情况。首先修改顶层 CMakeLists 文件，在 project 命令之后加入如下两行：</p> <div class="language-cmake line-numbers-mode"><pre class="language-cmake"><code><span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token variable">Demo_VERSION_MAJOR</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token variable">Demo_VERSION_MINOR</span> <span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>分别指定当前的项目的主版本号和副版本号。之后，为了在代码中获取版本信息，我们可以修改 config.h.in 文件，添加两个预定义变量：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">// the configured options and settings for Tutorial</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">Demo_VERSION_MAJOR</span> <span class="token expression">@Demo_VERSION_MAJOR@</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">Demo_VERSION_MINOR</span> <span class="token expression">@Demo_VERSION_MINOR@</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这样就可以直接在代码中打印版本信息了：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;math.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;config.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;math/MathFunctions.h&quot;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>argc <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// print version info</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s Version %d.%d\n&quot;</span><span class="token punctuation">,</span>
            argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            Demo_VERSION_MAJOR<span class="token punctuation">,</span>
            Demo_VERSION_MINOR<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Usage: %s base exponent \n&quot;</span><span class="token punctuation">,</span> argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">double</span> base <span class="token operator">=</span> <span class="token function">atof</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> exponent <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token function">defined</span> <span class="token punctuation">(</span>HAVE_POW<span class="token punctuation">)</span></span></span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Now we use the standard library. \n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">double</span> result <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span>base<span class="token punctuation">,</span> exponent<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Now we use our own Math library. \n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">double</span> result <span class="token operator">=</span> <span class="token function">power</span><span class="token punctuation">(</span>base<span class="token punctuation">,</span> exponent<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
    
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%g ^ %d is %g\n&quot;</span><span class="token punctuation">,</span> base<span class="token punctuation">,</span> exponent<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h2 id="生成安装包"><a href="#生成安装包" class="header-anchor">#</a> 生成安装包</h2> <p>本节对应的源代码所在目录：</p> <p><a href="https://github.com/wzpan/cmake-demo/tree/master/Demo8" target="_blank" rel="noopener noreferrer">https://github.com/wzpan/cmake-demo/tree/master/Demo8<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>本节将学习如何配置生成各种平台上的安装包，包括二进制安装包和源码安装包。为了完成这个任务，我们需要用到 <code>CPack</code> ，它同样也是由 <code>CMake</code> 提供的一个工具，专门用于打包。首先在顶层的 <code>CMakeLists.txt</code> 文件尾部添加下面几行：</p> <div class="language-cmake line-numbers-mode"><pre class="language-cmake"><code><span class="token comment"># 构建一个 CPack 安装包</span>
<span class="token keyword">include</span> <span class="token punctuation">(</span>InstallRequiredSystemLibraries<span class="token punctuation">)</span>
<span class="token keyword">set</span> <span class="token punctuation">(</span>CPACK_RESOURCE_FILE_LICENSE
  <span class="token string">&quot;<span class="token interpolation"><span class="token punctuation">${</span><span class="token variable">CMAKE_CURRENT_SOURCE_DIR</span><span class="token punctuation">}</span></span>/License.txt&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token variable">CPACK_PACKAGE_VERSION_MAJOR</span> <span class="token string">&quot;<span class="token interpolation"><span class="token punctuation">${</span><span class="token variable">Demo_VERSION_MAJOR</span><span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token variable">CPACK_PACKAGE_VERSION_MINOR</span> <span class="token string">&quot;<span class="token interpolation"><span class="token punctuation">${</span><span class="token variable">Demo_VERSION_MINOR</span><span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">include</span> <span class="token punctuation">(</span>CPack<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>上面的代码做了以下几个工作：</p> <p>导入 <code>InstallRequiredSystemLibraries</code> 模块，以便之后导入 <code>CPack</code> 模块；
设置一些 <code>CPack</code> 相关变量，包括版权信息和版本信息，其中版本信息用了上一节定义的版本号；
导入 <code>CPack</code> 模块。
接下来的工作是像往常一样构建工程，并执行 <code>cpack</code> 命令。</p> <p>生成二进制安装包：</p> <blockquote><p>cpack -C CPackConfig.cmake</p></blockquote> <p>生成源码安装包</p> <blockquote><p>cpack -C CPackSourceConfig.cmake</p></blockquote> <p>我们可以试一下。在生成项目后，执行 <code>cpack -C CPackConfig.cmake</code> 命令：</p> <div class="language-cmd line-numbers-mode"><pre class="language-text"><code>[ehome@xman Demo8]$ cpack -C CPackSourceConfig.cmake
CPack: Create package using STGZ
CPack: Install projects
CPack: - Run preinstall target for: Demo8
CPack: - Install project: Demo8
CPack: Create package
CPack: - package: /home/ehome/Documents/programming/C/power/Demo8/Demo8-1.0.1-Linux.sh generated.
CPack: Create package using TGZ
CPack: Install projects
CPack: - Run preinstall target for: Demo8
CPack: - Install project: Demo8
CPack: Create package
CPack: - package: /home/ehome/Documents/programming/C/power/Demo8/Demo8-1.0.1-Linux.tar.gz generated.
CPack: Create package using TZ
CPack: Install projects
CPack: - Run preinstall target for: Demo8
CPack: - Install project: Demo8
CPack: Create package
CPack: - package: /home/ehome/Documents/programming/C/power/Demo8/Demo8-1.0.1-Linux.tar.Z generated.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>此时会在该目录下创建 3 个不同格式的二进制包文件：</p> <div class="language-cmd line-numbers-mode"><pre class="language-text"><code>[ehome@xman Demo8]$ ls Demo8-*
Demo8-1.0.1-Linux.sh  Demo8-1.0.1-Linux.tar.gz  Demo8-1.0.1-Linux.tar.Z
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>这 3 个二进制包文件所包含的内容是完全相同的。我们可以执行其中一个。此时会出现一个由 <code>CPack</code> 自动生成的交互式安装界面：</p> <div class="language-cmd line-numbers-mode"><pre class="language-text"><code>[ehome@xman Demo8]$ sh Demo8-1.0.1-Linux.sh 
Demo8 Installer Version: 1.0.1, Copyright (c) Humanity
This is a self-extracting archive.
The archive will be extracted to: /home/ehome/Documents/programming/C/power/Demo8

If you want to stop extracting, please press &lt;ctrl-C&gt;.
The MIT License (MIT)

Copyright (c) 2013 Joseph Pan(http://hahack.com)

Permission is hereby granted, free of charge, to any person obtaining a copy of
this software and associated documentation files (the &quot;Software&quot;), to deal in
the Software without restriction, including without limitation the rights to
use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
the Software, and to permit persons to whom the Software is furnished to do so,
subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.


Do you accept the license? [yN]: 
y
By default the Demo8 will be installed in:
  &quot;/home/ehome/Documents/programming/C/power/Demo8/Demo8-1.0.1-Linux&quot;
Do you want to include the subdirectory Demo8-1.0.1-Linux?
Saying no will install in: &quot;/home/ehome/Documents/programming/C/power/Demo8&quot; [Yn]: 
y

Using target directory: /home/ehome/Documents/programming/C/power/Demo8/Demo8-1.0.1-Linux
Extracting, please wait...

Unpacking finished successfully
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><p>完成后提示安装到了 Demo8-1.0.1-Linux 子目录中，我们可以进去执行该程序：</p> <div class="language-cmd line-numbers-mode"><pre class="language-text"><code>[ehome@xman Demo8]$ ./Demo8-1.0.1-Linux/bin/Demo 5 2
Now we use our own Math library. 
5 ^ 2 is 25
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>关于 <code>CPack</code> 的更详细的用法可以通过 <code>man 1 cpack</code> 参考 <code>CPack</code> 的文档。</p> <h2 id="项目迁移"><a href="#项目迁移" class="header-anchor">#</a> 项目迁移</h2> <p>CMake 可以很轻松地构建出在适合各个平台执行的工程环境。而如果当前的工程环境不是 CMake ，而是基于某个特定的平台，是否可以迁移到 CMake 呢？答案是可能的。下面针对几个常用的平台，列出了它们对应的迁移方案。</p> <h3 id="autotools"><a href="#autotools" class="header-anchor">#</a> autotools</h3> <ul><li><code>am2cmake</code> 可以将 <code>autotools</code> 系的项目转换到 <code>CMake</code>，这个工具的一个成功案例是 KDE 。</li> <li><code>Alternative</code> <code>Automake2CMake</code> 可以转换使用 <code>automake</code> 的 <code>KDevelop</code> 工程项目。</li> <li>Converting autoconf tests</li></ul> <h3 id="qmake"><a href="#qmake" class="header-anchor">#</a> qmake</h3> <ul><li><code>qmake converter</code> 可以转换使用 QT 的 qmake 的工程。</li></ul> <h3 id="visual-studio"><a href="#visual-studio" class="header-anchor">#</a> Visual Studio</h3> <ul><li><code>vcproj2cmake.rb</code> 可以根据 Visual Studio 的工程文件（后缀名是 <code>.vcproj</code> 或 <code>.vcxproj</code>）生成 <code>CMakeLists.txt</code> 文件。</li> <li><code>vcproj2cmake.ps1</code> <code>vcproj2cmake</code> 的 <code>PowerShell</code> 版本。</li> <li><code>folders4cmake</code> 根据 Visual Studio 项目文件生成相应的 “source_group” 信息，这些信息可以很方便的在 <code>CMake</code> 脚本中使用。支持 Visual Studio 9/10 工程文件。</li></ul> <h3 id="cmakelists-txt-自动推导"><a href="#cmakelists-txt-自动推导" class="header-anchor">#</a> CMakeLists.txt 自动推导</h3> <ul><li><code>gencmake</code> 根据现有文件推导 <code>CMakeLists.txt</code> 文件。</li> <li><code>CMakeListGenerator</code> 应用一套文件和目录分析创建出完整的 <code>CMakeLists.txt</code> 文件。仅支持 Win32 平台。</li></ul> <h2 id="类似工具"><a href="#类似工具" class="header-anchor">#</a> 类似工具</h2> <ul><li>SCons：Eric S. Raymond、Timothee Besset、Zed A. Shaw 等大神力荐的项目架构工具。和 CMake 的最大区别是使用 Python 作为执行脚本</li></ul></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/su-dd/blogwriter/edit/master/docs/50.常用工具/20.CMake/2.CMake详解.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="tags"><a href="/tags/?tag=CMake" title="标签">#CMake</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2023/04/05, 23:49:51</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/6a3b4c/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">CMake简述</div></a> <a href="/pages/a038dc/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">NVM使用</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/6a3b4c/" class="prev">CMake简述</a></span> <span class="next"><a href="/pages/a038dc/">NVM使用</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/a038dc/"><div>
            NVM使用
            <!----></div></a> <span class="date">04-03</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/6a3b4c/"><div>
            CMake简述
            <!----></div></a> <span class="date">04-03</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/0466ae/"><div>
            Go-并发
            <!----></div></a> <span class="date">03-16</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:987380454@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/su-dd" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2023
    <span>daidai | <a href="https://beian.miit.gov.cn/" target="_blank">皖ICP备2023000523号-1</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"><div></div><div></div><!----></div></div>
    <script src="/assets/js/app.b2b0617d.js" defer></script><script src="/assets/js/2.cff562a5.js" defer></script><script src="/assets/js/40.238ee8ee.js" defer></script><script src="/assets/js/8.7397f135.js" defer></script>
  </body>
</html>
