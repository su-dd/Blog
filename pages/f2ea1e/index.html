<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>深入理解：C++内存分配 | 苏呆呆的博客</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_3077305_pt8umhrn4k9.css">
    <script>var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?3d63e1b0aa607833cafb451888226547";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();</script>
    <script async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" data-ad-client="ca-pub-2770102725717150" crossorigin="anonymous"></script>
    <meta name="description" content="一个向往美好生活的笨人。">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta name="keywords" content="su-dd,苏呆呆,苏呆呆的博客,呆呆的博客,个人技术博客,技术文档,c++基础,c++提高,c11,c++新特性,c++,java,spring,ddd,面向对象,设计模式,汇编,git,springcloud,面试,git,github,markdown,md文档,vdoing,demo">
    <meta name="theme-color" content="#11a8cd">
    <meta name="baidu_union_verify" content="0c4ba741a75f427faa8dd9c724a81b73">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    
    <link rel="preload" href="/assets/css/0.styles.a6635593.css" as="style"><link rel="preload" href="/assets/js/app.b2b0617d.js" as="script"><link rel="preload" href="/assets/js/2.cff562a5.js" as="script"><link rel="preload" href="/assets/js/109.1b22a6eb.js" as="script"><link rel="preload" href="/assets/js/8.7397f135.js" as="script"><link rel="prefetch" href="/assets/js/10.2cd4b68b.js"><link rel="prefetch" href="/assets/js/100.60b800ef.js"><link rel="prefetch" href="/assets/js/101.66701792.js"><link rel="prefetch" href="/assets/js/102.c3b3591c.js"><link rel="prefetch" href="/assets/js/103.92e4ddd8.js"><link rel="prefetch" href="/assets/js/104.691282f2.js"><link rel="prefetch" href="/assets/js/105.c5599995.js"><link rel="prefetch" href="/assets/js/106.af3edb3d.js"><link rel="prefetch" href="/assets/js/107.c25e9863.js"><link rel="prefetch" href="/assets/js/108.1e3aeebe.js"><link rel="prefetch" href="/assets/js/11.733d4ab2.js"><link rel="prefetch" href="/assets/js/110.d40a1bca.js"><link rel="prefetch" href="/assets/js/111.c3ea7452.js"><link rel="prefetch" href="/assets/js/112.d96e8508.js"><link rel="prefetch" href="/assets/js/113.658cb11a.js"><link rel="prefetch" href="/assets/js/114.381756eb.js"><link rel="prefetch" href="/assets/js/115.41cc8435.js"><link rel="prefetch" href="/assets/js/116.05139cac.js"><link rel="prefetch" href="/assets/js/117.963900c8.js"><link rel="prefetch" href="/assets/js/118.37965514.js"><link rel="prefetch" href="/assets/js/119.823c0b39.js"><link rel="prefetch" href="/assets/js/12.f5a70e82.js"><link rel="prefetch" href="/assets/js/120.d3655be7.js"><link rel="prefetch" href="/assets/js/121.7e3815cd.js"><link rel="prefetch" href="/assets/js/122.dd04ca2c.js"><link rel="prefetch" href="/assets/js/123.5eec9a72.js"><link rel="prefetch" href="/assets/js/124.92a29444.js"><link rel="prefetch" href="/assets/js/125.63e42c6a.js"><link rel="prefetch" href="/assets/js/126.55a1d374.js"><link rel="prefetch" href="/assets/js/127.1beb1614.js"><link rel="prefetch" href="/assets/js/128.99051007.js"><link rel="prefetch" href="/assets/js/129.beb99217.js"><link rel="prefetch" href="/assets/js/13.4d8c1284.js"><link rel="prefetch" href="/assets/js/130.329d962a.js"><link rel="prefetch" href="/assets/js/131.59b74420.js"><link rel="prefetch" href="/assets/js/132.fce7d641.js"><link rel="prefetch" href="/assets/js/133.21a55328.js"><link rel="prefetch" href="/assets/js/134.c43d0376.js"><link rel="prefetch" href="/assets/js/135.ea174984.js"><link rel="prefetch" href="/assets/js/136.be318aaa.js"><link rel="prefetch" href="/assets/js/137.d84d5582.js"><link rel="prefetch" href="/assets/js/138.4b34b72b.js"><link rel="prefetch" href="/assets/js/139.df5ea758.js"><link rel="prefetch" href="/assets/js/14.518510ed.js"><link rel="prefetch" href="/assets/js/140.0d57d5ab.js"><link rel="prefetch" href="/assets/js/141.4a719260.js"><link rel="prefetch" href="/assets/js/142.6753af99.js"><link rel="prefetch" href="/assets/js/143.ba256a59.js"><link rel="prefetch" href="/assets/js/144.a7ebd62e.js"><link rel="prefetch" href="/assets/js/145.a27410d5.js"><link rel="prefetch" href="/assets/js/146.ca494a45.js"><link rel="prefetch" href="/assets/js/147.6fdefa7e.js"><link rel="prefetch" href="/assets/js/148.71fb2e90.js"><link rel="prefetch" href="/assets/js/149.a8a7065d.js"><link rel="prefetch" href="/assets/js/15.a266a355.js"><link rel="prefetch" href="/assets/js/150.90099809.js"><link rel="prefetch" href="/assets/js/151.71bb788d.js"><link rel="prefetch" href="/assets/js/152.6ec0f3e3.js"><link rel="prefetch" href="/assets/js/153.3790a3de.js"><link rel="prefetch" href="/assets/js/154.152c7b24.js"><link rel="prefetch" href="/assets/js/155.bfa10f50.js"><link rel="prefetch" href="/assets/js/156.d3e6f6a6.js"><link rel="prefetch" href="/assets/js/157.93423f96.js"><link rel="prefetch" href="/assets/js/158.193f485f.js"><link rel="prefetch" href="/assets/js/159.b1fe6678.js"><link rel="prefetch" href="/assets/js/16.69ecfe5a.js"><link rel="prefetch" href="/assets/js/160.971bd865.js"><link rel="prefetch" href="/assets/js/161.15f6e202.js"><link rel="prefetch" href="/assets/js/162.fe071dc9.js"><link rel="prefetch" href="/assets/js/163.da0876dc.js"><link rel="prefetch" href="/assets/js/164.c6a447f0.js"><link rel="prefetch" href="/assets/js/165.fc7a3304.js"><link rel="prefetch" href="/assets/js/166.203d55bb.js"><link rel="prefetch" href="/assets/js/17.a6a5e59d.js"><link rel="prefetch" href="/assets/js/18.8c9e44cc.js"><link rel="prefetch" href="/assets/js/19.2861a5bd.js"><link rel="prefetch" href="/assets/js/20.dabdcc5e.js"><link rel="prefetch" href="/assets/js/21.b8317130.js"><link rel="prefetch" href="/assets/js/22.46e9b7da.js"><link rel="prefetch" href="/assets/js/23.a4025da6.js"><link rel="prefetch" href="/assets/js/24.c2fbd549.js"><link rel="prefetch" href="/assets/js/25.30472c64.js"><link rel="prefetch" href="/assets/js/26.442945fd.js"><link rel="prefetch" href="/assets/js/27.4a086f9b.js"><link rel="prefetch" href="/assets/js/28.edf89f24.js"><link rel="prefetch" href="/assets/js/29.151226bf.js"><link rel="prefetch" href="/assets/js/3.531acd57.js"><link rel="prefetch" href="/assets/js/30.6c067212.js"><link rel="prefetch" href="/assets/js/31.bb1540d1.js"><link rel="prefetch" href="/assets/js/32.09f5cc25.js"><link rel="prefetch" href="/assets/js/33.5261d5ea.js"><link rel="prefetch" href="/assets/js/34.51c795e3.js"><link rel="prefetch" href="/assets/js/35.12f7f988.js"><link rel="prefetch" href="/assets/js/36.8327db33.js"><link rel="prefetch" href="/assets/js/37.112f6c0b.js"><link rel="prefetch" href="/assets/js/38.20191ba3.js"><link rel="prefetch" href="/assets/js/39.e45a5efd.js"><link rel="prefetch" href="/assets/js/4.917e5a2f.js"><link rel="prefetch" href="/assets/js/40.238ee8ee.js"><link rel="prefetch" href="/assets/js/41.be9bf62e.js"><link rel="prefetch" href="/assets/js/42.3a4f56b4.js"><link rel="prefetch" href="/assets/js/43.92f23c09.js"><link rel="prefetch" href="/assets/js/44.e5053632.js"><link rel="prefetch" href="/assets/js/45.52ab3b68.js"><link rel="prefetch" href="/assets/js/46.c2589849.js"><link rel="prefetch" href="/assets/js/47.102e88ad.js"><link rel="prefetch" href="/assets/js/48.bf524334.js"><link rel="prefetch" href="/assets/js/49.0f9ffe85.js"><link rel="prefetch" href="/assets/js/5.323082ce.js"><link rel="prefetch" href="/assets/js/50.43cb2571.js"><link rel="prefetch" href="/assets/js/51.976889fe.js"><link rel="prefetch" href="/assets/js/52.118f8b22.js"><link rel="prefetch" href="/assets/js/53.06a3f5cd.js"><link rel="prefetch" href="/assets/js/54.493670ce.js"><link rel="prefetch" href="/assets/js/55.0a6a171b.js"><link rel="prefetch" href="/assets/js/56.36041806.js"><link rel="prefetch" href="/assets/js/57.3abb2bd6.js"><link rel="prefetch" href="/assets/js/58.9c30f62c.js"><link rel="prefetch" href="/assets/js/59.f5e92ffb.js"><link rel="prefetch" href="/assets/js/6.fba4ebfe.js"><link rel="prefetch" href="/assets/js/60.14f8e778.js"><link rel="prefetch" href="/assets/js/61.f555540c.js"><link rel="prefetch" href="/assets/js/62.e596fc73.js"><link rel="prefetch" href="/assets/js/63.0c349e67.js"><link rel="prefetch" href="/assets/js/64.dd07a2e6.js"><link rel="prefetch" href="/assets/js/65.315a6949.js"><link rel="prefetch" href="/assets/js/66.1c5ded71.js"><link rel="prefetch" href="/assets/js/67.494d92bb.js"><link rel="prefetch" href="/assets/js/68.aef647d2.js"><link rel="prefetch" href="/assets/js/69.45bd65a7.js"><link rel="prefetch" href="/assets/js/7.45101e24.js"><link rel="prefetch" href="/assets/js/70.06c91bba.js"><link rel="prefetch" href="/assets/js/71.b8aece77.js"><link rel="prefetch" href="/assets/js/72.7cf0f3d3.js"><link rel="prefetch" href="/assets/js/73.f49fdd95.js"><link rel="prefetch" href="/assets/js/74.5a806d23.js"><link rel="prefetch" href="/assets/js/75.91f2b41a.js"><link rel="prefetch" href="/assets/js/76.1db73a7f.js"><link rel="prefetch" href="/assets/js/77.39aa2f0f.js"><link rel="prefetch" href="/assets/js/78.dcd5cc8e.js"><link rel="prefetch" href="/assets/js/79.df14cf99.js"><link rel="prefetch" href="/assets/js/80.2b3b8b9f.js"><link rel="prefetch" href="/assets/js/81.80345e8a.js"><link rel="prefetch" href="/assets/js/82.ed95ca0d.js"><link rel="prefetch" href="/assets/js/83.335e4184.js"><link rel="prefetch" href="/assets/js/84.b219dc4b.js"><link rel="prefetch" href="/assets/js/85.9d032788.js"><link rel="prefetch" href="/assets/js/86.55f210e6.js"><link rel="prefetch" href="/assets/js/87.a0db9e8f.js"><link rel="prefetch" href="/assets/js/88.b3537c8a.js"><link rel="prefetch" href="/assets/js/89.33570411.js"><link rel="prefetch" href="/assets/js/9.20fcb649.js"><link rel="prefetch" href="/assets/js/90.941c4684.js"><link rel="prefetch" href="/assets/js/91.be607e5a.js"><link rel="prefetch" href="/assets/js/92.f0d5e953.js"><link rel="prefetch" href="/assets/js/93.b8937166.js"><link rel="prefetch" href="/assets/js/94.b252b8a4.js"><link rel="prefetch" href="/assets/js/95.8af820f5.js"><link rel="prefetch" href="/assets/js/96.9dcd0ab0.js"><link rel="prefetch" href="/assets/js/97.9699c160.js"><link rel="prefetch" href="/assets/js/98.e1d14407.js"><link rel="prefetch" href="/assets/js/99.eb86b749.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a6635593.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="苏呆呆的博客" class="logo"> <span class="site-name can-hide">苏呆呆的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程语言" class="dropdown-title"><a href="/language/" class="link-title">编程语言</a> <span class="title" style="display:none;">编程语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/language/c++/" class="nav-link">C++</a></li><li class="dropdown-item"><!----> <a href="/language/java/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/language/go/" class="nav-link">Go</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="软件设计" class="dropdown-title"><a href="/design/" class="link-title">软件设计</a> <span class="title" style="display:none;">软件设计</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/design/oo/" class="nav-link">面向对象</a></li><li class="dropdown-item"><!----> <a href="/design/GoF/" class="nav-link">设计模式</a></li><li class="dropdown-item"><!----> <a href="/design/ddd/" class="nav-link">领域驱动设计</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常用框架" class="dropdown-title"><a href="/frame/" class="link-title">常用框架</a> <span class="title" style="display:none;">常用框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frame/spring/" class="nav-link">Spring</a></li></ul></div></div><div class="nav-item"><a href="/tools/" class="nav-link">常用工具</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/archives/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>本站</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-subitem"><a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-subitem"><a href="/archives/" class="nav-link">归档</a></li></ul></li><li class="dropdown-item"><h4>我的</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/about/" class="nav-link">关于</a></li><li class="dropdown-subitem"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></li></ul></li></ul></div></div> <a href="https://github.com/su-dd/blogwriter" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.addai.cn/blog/网站使用/呆呆.webp"> <div class="blogger-info"><h3>苏呆呆</h3> <span>一个向往美好生活的笨人。</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程语言" class="dropdown-title"><a href="/language/" class="link-title">编程语言</a> <span class="title" style="display:none;">编程语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/language/c++/" class="nav-link">C++</a></li><li class="dropdown-item"><!----> <a href="/language/java/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/language/go/" class="nav-link">Go</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="软件设计" class="dropdown-title"><a href="/design/" class="link-title">软件设计</a> <span class="title" style="display:none;">软件设计</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/design/oo/" class="nav-link">面向对象</a></li><li class="dropdown-item"><!----> <a href="/design/GoF/" class="nav-link">设计模式</a></li><li class="dropdown-item"><!----> <a href="/design/ddd/" class="nav-link">领域驱动设计</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常用框架" class="dropdown-title"><a href="/frame/" class="link-title">常用框架</a> <span class="title" style="display:none;">常用框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frame/spring/" class="nav-link">Spring</a></li></ul></div></div><div class="nav-item"><a href="/tools/" class="nav-link">常用工具</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/archives/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>本站</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-subitem"><a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-subitem"><a href="/archives/" class="nav-link">归档</a></li></ul></li><li class="dropdown-item"><h4>我的</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/about/" class="nav-link">关于</a></li><li class="dropdown-subitem"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></li></ul></li></ul></div></div> <a href="https://github.com/su-dd/blogwriter" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>深入理解</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/f2ea1e/" aria-current="page" class="active sidebar-link">深入理解：C++内存分配</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/f2ea1e/#什么是内存模型" class="sidebar-link">什么是内存模型</a></li><li class="sidebar-sub-header level2"><a href="/pages/f2ea1e/#内存的分类" class="sidebar-link">内存的分类</a></li><li class="sidebar-sub-header level2"><a href="/pages/f2ea1e/#各分区例程" class="sidebar-link">各分区例程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/f2ea1e/#全局-静态存储区" class="sidebar-link">全局/静态存储区</a></li><li class="sidebar-sub-header level3"><a href="/pages/f2ea1e/#常量区" class="sidebar-link">常量区</a></li><li class="sidebar-sub-header level3"><a href="/pages/f2ea1e/#栈-stack-区域" class="sidebar-link">栈（Stack）区域</a></li><li class="sidebar-sub-header level3"><a href="/pages/f2ea1e/#堆-heap-区域" class="sidebar-link">堆（Heap）区域</a></li><li class="sidebar-sub-header level3"><a href="/pages/f2ea1e/#堆和栈的区别" class="sidebar-link">堆和栈的区别</a></li><li class="sidebar-sub-header level3"><a href="/pages/f2ea1e/#堆和自由存储区的区别" class="sidebar-link">堆和自由存储区的区别</a></li><li class="sidebar-sub-header level3"><a href="/pages/f2ea1e/#malloc-free和new-delete的区别" class="sidebar-link">malloc/free和new/delete的区别</a></li><li class="sidebar-sub-header level3"><a href="/pages/f2ea1e/#c-中new-delete的工作过程" class="sidebar-link">C++中new/delete的工作过程</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/f2ea1e/#参考文档" class="sidebar-link">参考文档</a></li></ul></li><li><a href="/pages/f95db2/" class="sidebar-link">深入理解：变量、引用、指针</a></li><li><a href="/pages/f2ea1f/" class="sidebar-link">C++类的默认函数</a></li><li><a href="/pages/9516e1/" class="sidebar-link">深入理解：继承和虚表</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/categories/?category=%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80--C%2B%2B" title="分类" data-v-06225672>编程语言--C++</a></li><li data-v-06225672><a href="/categories/?category=%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3" title="分类" data-v-06225672>深入理解</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/su-dd" target="_blank" title="作者" class="beLink" data-v-06225672>su-dd</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-01-08</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">深入理解：C++内存分配<!----></h1>  <div class="theme-vdoing-content content__default"><p>程序一般都是在内存中跑的，这章主要讲c++程序运行时的内存分配问题。</p> <p>讲解包括：内存申请使用的关键字、各种变量在内存中的位置、程序代码在内存中的位置。</p> <p>这篇会从网络中多篇文档中汲取能量，如果未能罗列引用望海涵</p> <h2 id="什么是内存模型"><a href="#什么是内存模型" class="header-anchor">#</a> 什么是内存模型</h2> <p>内存模型就是一种语言它独特的管理者一套程序的机制</p> <p>C语言会将内存区域划分成堆、栈、静态全局变量区、常量区；</p> <p>C++则分为堆、栈、自由存储区、全局/静态变量区、常量存储区；</p> <p>划分的目的是为了能够方便编译器的管理和运行</p> <h2 id="内存的分类"><a href="#内存的分类" class="header-anchor">#</a> 内存的分类</h2> <table><thead><tr><th style="text-align:left;">分类标准</th> <th style="text-align:left;">分区数量</th></tr></thead> <tbody><tr><td style="text-align:left;">两大分区</td> <td style="text-align:left;">代码区、数据区</td></tr> <tr><td style="text-align:left;">四大分区</td> <td style="text-align:left;">代码区、全局区（全局/静态存储区）、栈区、堆区</td></tr> <tr><td style="text-align:left;">c语言分区</td> <td style="text-align:left;">堆、栈、静态全局变量区、常量区</td></tr> <tr><td style="text-align:left;">c++语言分区</td> <td style="text-align:left;">堆、栈、自由存储区、全局/静态变量区、常量存储区</td></tr></tbody></table> <p>内存模型根据生命周期的不同分区 自由存储区、动态区、静态区
我们就按照C++语言的内存划分区域来讲解内存管理机制</p> <p><img src="https://cdn.addai.cn/blog/202304092008990.png" alt="内存分配"></p> <p><strong>文本段（ELF）：</strong> 主要用于存放我们编写的代码，但是不是按照代码文本的形式存放，而是将代码文本编译成二进制代码，存放的是二进制代码，在编译时就已经确定这个区域存放的内容是什么了，并且这个区域是只读区域</p> <p><strong>DATA段：</strong> 这个区域主要用于存放编译阶段（非运行阶段时）就能确定的数据，也就是初始化的静态变量、全局变量和常量，这个区域是可读可写的。这也就是我们通常说的静态存储区</p> <p><strong>BSS段：</strong> 这个区域存放的是未曾初始化的静态变量、全局变量，但是不会存放常量，因为常量在定义的时候就一定会赋值了。未初始化的全局变量和静态变量，编译器在编译阶段都会将其默认为0</p> <p><strong>HEAP（堆）：</strong> 这个区域实在运行时使用的，主要是用来存放程序员分配和释放内存，程序结束时操作系统会对其进行回收，（程序员分配内存像malloc、free、new、delete）都是在这个区域进行的</p> <p><strong>STACK（栈）：</strong> 存放函数的参数值和局部变量，这个区域的数据是由编译器来自己分配和释放的，只要执行完这个函数，那么这些参数值和变量都会被释放掉</p> <p><strong>内核空间（env）环境变量：</strong> 这个区域是系统内部的区域，我们是不可编辑的</p> <h2 id="各分区例程"><a href="#各分区例程" class="header-anchor">#</a> 各分区例程</h2> <h3 id="全局-静态存储区"><a href="#全局-静态存储区" class="header-anchor">#</a> 全局/静态存储区</h3> <p>这个区域有两个段，分别是 <code>BSS段</code> 和 <code>DATA段</code> ，均存放着<code>全局变量</code>和<code>静态变量</code>（包括<code>全局静态变量</code>和<code>局部静态变量</code>）</p> <p>其中 BSS存放的是程序员编写的<strong>未初始化</strong>的 <code>全局变量</code> 和 <code>静态变量</code> 而DATA存放<strong>已经初始化</strong>的全局变量、静态变量和常量。</p> <p>这其中C和C++的BSS还有区别，区别就是：C中的BSS段分为高地址和低地址，高地址是存放全局变量，低地址是存放静态未初始化</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream&gt;</span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token comment">/*定义全局变量*/</span>
<span class="token keyword">int</span> serven_1<span class="token punctuation">;</span>                       <span class="token comment">// 定义未初始化的全局变量</span>
<span class="token keyword">int</span> serven_2 <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>                   <span class="token comment">// 定义初始化的全局变量</span>

<span class="token keyword">static</span> <span class="token keyword">int</span> serven_3<span class="token punctuation">;</span>                <span class="token comment">// 定义未初始化的静态变量</span>
<span class="token keyword">static</span> <span class="token keyword">int</span> serven_4 <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>            <span class="token comment">// 定义初始化的静态变量</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    cout<span class="token operator">&lt;&lt;</span><span class="token string">&quot;BSS:&quot;</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
    cout<span class="token operator">&lt;&lt;</span><span class="token string">&quot;The address of serven_1:&quot;</span><span class="token operator">&lt;&lt;</span><span class="token operator">&amp;</span>serven_1<span class="token operator">&lt;&lt;</span><span class="token string">&quot;, The data of serven_1:&quot;</span><span class="token operator">&lt;&lt;</span>serven_1<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
    cout<span class="token operator">&lt;&lt;</span><span class="token string">&quot;The address of serven_3:&quot;</span><span class="token operator">&lt;&lt;</span><span class="token operator">&amp;</span>serven_3<span class="token operator">&lt;&lt;</span><span class="token string">&quot;, The data of serven_3:&quot;</span><span class="token operator">&lt;&lt;</span>serven_3<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>

    cout<span class="token operator">&lt;&lt;</span><span class="token string">&quot;DATA:&quot;</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
    cout<span class="token operator">&lt;&lt;</span><span class="token string">&quot;The address of serven_2:&quot;</span><span class="token operator">&lt;&lt;</span><span class="token operator">&amp;</span>serven_2<span class="token operator">&lt;&lt;</span><span class="token string">&quot;, The data of serven_2:&quot;</span><span class="token operator">&lt;&lt;</span>serven_2<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
    cout<span class="token operator">&lt;&lt;</span><span class="token string">&quot;The address of serven_4:&quot;</span><span class="token operator">&lt;&lt;</span><span class="token operator">&amp;</span>serven_4<span class="token operator">&lt;&lt;</span><span class="token string">&quot;, The data of serven_4:&quot;</span><span class="token operator">&lt;&lt;</span>serven_4<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p><strong>运行结果：</strong></p> <div class="language-cmd line-numbers-mode"><pre class="language-text"><code>BSS:
The address of serven_1:00007FF7F3C2E180, The data of serven_1:0
The address of serven_3:00007FF7F3C2E184, The data of serven_3:0
DATA:
The address of serven_2:00007FF7F3C2E000, The data of serven_2:2
The address of serven_4:00007FF7F3C2E004, The data of serven_4:4
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>结果分析：</strong>
程序定义了两个全局变量 <code>serven_1</code> 和 <code>serven_2</code> ，两个静态变量 <code>serven_3</code> 和 <code>serven_4</code> ，其中 <code>serven_2</code> 和 <code>serven_4</code> 是初始化的，所以 <code>serven_1</code> 和 <code>serven_3</code> 是存放在 <code>BSS段</code> ，并且编译器会将这两个未初始化的变量默认初始化为 <code>0</code> ；而 <code>serven_2</code> 和 <code>serven_4</code> 这两个变量是初始化的，存放在 <code>DATA段</code></p> <h3 id="常量区"><a href="#常量区" class="header-anchor">#</a> 常量区</h3> <p>上面说到常量是存放在DATA段区域的，下面我们来看一下例子：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream&gt;</span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token comment">/*定于全局常量*/</span>
<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> serven_5 <span class="token operator">=</span><span class="token string">&quot;serven&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> serven_6 <span class="token operator">=</span><span class="token string">&quot;serven&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> <span class="token operator">*</span> serven_7 <span class="token operator">=</span> <span class="token string">&quot;serven&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> <span class="token operator">*</span> serven_8 <span class="token operator">=</span> serven_7<span class="token punctuation">;</span>
    <span class="token keyword">char</span> s<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">&quot;serven&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> s2<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">&quot;serven&quot;</span><span class="token punctuation">;</span>
    s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token char">'1'</span><span class="token punctuation">;</span>
    <span class="token operator">*</span>s<span class="token operator">=</span><span class="token char">'1'</span><span class="token punctuation">;</span>
    cout<span class="token operator">&lt;&lt;</span><span class="token string">&quot;The address of serven_5:&quot;</span><span class="token operator">&lt;&lt;</span><span class="token operator">&amp;</span>serven_5<span class="token operator">&lt;&lt;</span><span class="token string">&quot;, The data of serven_5:&quot;</span><span class="token operator">&lt;&lt;</span>serven_5<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
    cout<span class="token operator">&lt;&lt;</span><span class="token string">&quot;The address of serven_6:&quot;</span><span class="token operator">&lt;&lt;</span><span class="token operator">&amp;</span>serven_6<span class="token operator">&lt;&lt;</span><span class="token string">&quot;, The data of serven_6:&quot;</span><span class="token operator">&lt;&lt;</span>serven_6<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
    cout<span class="token operator">&lt;&lt;</span><span class="token string">&quot;The address of serven_7:&quot;</span><span class="token operator">&lt;&lt;</span><span class="token operator">&amp;</span>serven_7<span class="token operator">&lt;&lt;</span><span class="token string">&quot;, The data of serven_7:&quot;</span><span class="token operator">&lt;&lt;</span>serven_7<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
    cout<span class="token operator">&lt;&lt;</span><span class="token string">&quot;The address of serven_8:&quot;</span><span class="token operator">&lt;&lt;</span><span class="token operator">&amp;</span>serven_8<span class="token operator">&lt;&lt;</span><span class="token string">&quot;, The data of serven_8:&quot;</span><span class="token operator">&lt;&lt;</span>serven_8<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>

    cout<span class="token operator">&lt;&lt;</span><span class="token string">&quot;The address of s:&quot;</span><span class="token operator">&lt;&lt;</span>s<span class="token operator">&lt;&lt;</span><span class="token string">&quot;, The data of s:&quot;</span><span class="token operator">&lt;&lt;</span>s<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
    cout<span class="token operator">&lt;&lt;</span><span class="token string">&quot;The address of s2:&quot;</span><span class="token operator">&lt;&lt;</span>s2<span class="token operator">&lt;&lt;</span><span class="token string">&quot;, The data of s2:&quot;</span><span class="token operator">&lt;&lt;</span>s2<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;The Pointer of serven_5 :%p\n&quot;</span><span class="token punctuation">,</span>serven_5<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;The Pointer of serven_6 :%p\n&quot;</span><span class="token punctuation">,</span>serven_6<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;The Pointer of serven_7 :%p\n&quot;</span><span class="token punctuation">,</span>serven_7<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;The Pointer of serven_8 :%p\n&quot;</span><span class="token punctuation">,</span>serven_8<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;The Pointer of s :%p\n&quot;</span><span class="token punctuation">,</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;The Pointer of s2 :%p\n&quot;</span><span class="token punctuation">,</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p><strong>Release​运行结果：</strong></p> <div class="language-cmd line-numbers-mode"><pre class="language-text"><code>The address of serven_5:00007FF6558F5008, The data of serven_5:serven
The address of serven_6:00000096D82FFE60, The data of serven_6:serven
The address of serven_7:00000096D82FFE68, The data of serven_7:serven
The address of serven_8:00000096D82FFE70, The data of serven_8:serven
The address of s:11rven, The data of s:11rven
The address of s2:serven, The data of s2:serven
The Pointer of serven_5 :00007FF6558F32B0
The Pointer of serven_6 :00007FF6558F32B0
The Pointer of serven_7 :00007FF6558F32B0
The Pointer of serven_8 :00007FF6558F32B0
The Pointer of s :00000096D82FFE78
The Pointer of s2 :00000096D82FFE80
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><em>这里需要注意的是上面的结果是release的输出，debug的结果并不一定相同。</em></p> <p><strong>结果解析：</strong></p> <p>变量 <code>serven_5</code> 是常量，存储在 <code>DATA段</code> 区域， <code>serven_6</code> 是局部的常量、 <code>serven_7</code> 和 <code>serven_8</code> 是局部的变量指针，他们都是指向一个常量 “serven”，这个常量存储在常量区的，也就是存储在DATA区域，可以看到在后面打印serven_5~serven_8的时候的地址都是一样的，都是存储在DATA区域。</p> <p>而 <code>s</code> 和 <code>s2</code> 是局部变量，存储在栈区域，可以看到代码中打印出来的指针都是在栈区域里面。</p> <p>总结就是： <code>s</code> 和 <code>s2</code> 是定义在局部函数里面的变量，所以存放在栈区域，<code>serven_6</code> ~ <code>serven_8</code> 是定义在局部里面的指针，指向的是常量，所以指向的常量存放在DATA区域，而指针本身存放在栈中</p> <h3 id="栈-stack-区域"><a href="#栈-stack-区域" class="header-anchor">#</a> 栈（Stack）区域</h3> <p>栈区域是编译器自动根据变量进行分配的，不是由程序员进行开辟的，所以编译器即会自动分配也会将其释放，这个区域主要存放函数的参数值、局部变量、形参等等。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream&gt;</span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">TEST</span><span class="token punctuation">(</span><span class="token keyword">int</span> ser_x<span class="token punctuation">,</span> <span class="token keyword">int</span> ser_y<span class="token punctuation">,</span> <span class="token keyword">int</span> ser_z<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">int</span> serven_9 <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> serven_10 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> serven_11 <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;The Pointer of ser_x is: %p\n&quot;</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>ser_x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;The Pointer of ser_y is: %p\n&quot;</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>ser_y<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;The Pointer of ser_z is: %p\n&quot;</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>ser_z<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;The Pointer of serven_9(TEST) is: %p\n&quot;</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>serven_9<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;The Pointer of serven_10(TEST) is: %p\n&quot;</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>serven_10<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;The Pointer of serven_11(TEST) is: %p\n&quot;</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>serven_11<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> serven_9 <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> serven_10 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> serven_11 <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;The Pointer of serven_9(MAIN) is: %p\n&quot;</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>serven_9<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;The Pointer of serven_10(MAIN) is: %p\n&quot;</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>serven_10<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;The Pointer of serven_11(MAIN) is: %p\n&quot;</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>serven_11<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">TEST</span><span class="token punctuation">(</span>serven_9<span class="token punctuation">,</span> serven_10<span class="token punctuation">,</span>serven_11<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> serven_12 <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;The Pointer of serven_12 is: %p\n&quot;</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>serven_12<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p><strong>Debug​运行结果：</strong></p> <div class="language-cmd line-numbers-mode"><pre class="language-text"><code>The Pointer of serven_9(MAIN) is: 0000002338fff9ac
The Pointer of serven_10(MAIN) is: 0000002338fff9a8
The Pointer of serven_11(MAIN) is: 0000002338fff9a4
The Pointer of ser_x is: 0000002338fff980
The Pointer of ser_y is: 0000002338fff988
The Pointer of ser_z is: 0000002338fff990
The Pointer of serven_9(TEST) is: 0000002338fff96c
The Pointer of serven_10(TEST) is: 0000002338fff968
The Pointer of serven_11(TEST) is: 0000002338fff964
The Pointer of serven_12(MAIN) is: 0000002338fff9a0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><em>这里注意：release版本，对局部变量有优化，结果就不同了</em></p> <p><strong>结果解析：</strong>
首先我们先来看一下这个图，是内存管理机制里面的栈，可以看到main函数中定义的变量<code>serven_9</code> ~ <code>serven_11</code>分别入栈，而且入栈的顺序是从高地址到低地址，每个变量占用4个字节，所以地址相差也就是4个字节</p> <p>然后就是形参入栈，<strong>形参入栈顺序是从右往左入栈</strong>，所以<code>ser_z~ser_x</code>的地址也是依次递减的</p> <p>最后就是TEST函数里面的局部变量，将局部变量<code>serven_9 ~ serven_11</code>依次入栈，并且地址也是一次递减</p> <p>而且可以看到<code>serven_12</code>的地址和<code>serven_11</code>是隔壁，由此可以看出，栈的先进后出，也就是调用完函数TEST后会把局部变量<code>serven_11（TEST）~serven_9（TEST）</code>、<code>serv_x~ser_z</code>全部出栈，然后再将<code>serven_12</code>入栈。</p> <p><img src="https://cdn.addai.cn/blog/202304100100360.png" alt="栈地址"></p> <p>但是，我们可以发现了定义<code>serven_11</code>之后的调用函数，函数的形参入栈的地址与s<code>erven_11</code>定义时的地址相差很远，大概有三个字节，这三个字节中有一个是<code>serven_11</code>，那么多出来两个字节是什么呢？</p> <p>这是因为在调用函数的时候会进行一些操作：</p> <p>首先我们需要了解几个概念：<code>栈帧</code>、<code>寄存器esp</code>、<code>寄存器ebp</code></p> <p><code>栈帧</code>:每个函数有自己的栈帧，栈帧中维持着所需要的各种信息（包括参数、返回地址、参数个数、其它）
<code>寄存器esp</code>: 保存当前栈帧的栈顶
<code>寄存器ebp</code>: 保存当前栈帧的栈底</p> <p>那么函数在栈入参时候的结构为：</p> <p>函数的局部变量：（ebp）最右参数-&gt;中间参数-&gt;最左参数-&gt;返回地址-&gt;运行时参数（esp）；</p> <h3 id="堆-heap-区域"><a href="#堆-heap-区域" class="header-anchor">#</a> 堆（Heap）区域</h3> <p>这个区域是由程序员来进行分配内存和释放内存用的，当我们使用malloc/free、new/delete（这是在自由存储区上分配和释放的，某种意义上来说呢，起始自由存储区是堆的一个子集）。</p> <p>在这里要注意的是，我们申请了空间内存一定要释放，如果没有释放那就会导致内存的泄露，后果很严重！！！你遇到过的电脑蓝屏也许就是内存泄漏引起的。</p> <h3 id="堆和栈的区别"><a href="#堆和栈的区别" class="header-anchor">#</a> 堆和栈的区别</h3> <table><thead><tr><th style="text-align:left;">比较类别</th> <th style="text-align:left;">堆</th> <th style="text-align:left;">栈</th></tr></thead> <tbody><tr><td style="text-align:left;">管理方式</td> <td style="text-align:left;">由程序员分配和释放</td> <td style="text-align:left;">编译器自动管理</td></tr> <tr><td style="text-align:left;">空间大小</td> <td style="text-align:left;">最大可达4GB</td> <td style="text-align:left;">空间有限</td></tr> <tr><td style="text-align:left;">产生碎片</td> <td style="text-align:left;">会造成空间碎片</td> <td style="text-align:left;">不会</td></tr> <tr><td style="text-align:left;">生长方向</td> <td style="text-align:left;">向上生长（低地址-高地址）</td> <td style="text-align:left;">向下生长（高地址-低地址）</td></tr> <tr><td style="text-align:left;">分配方式</td> <td style="text-align:left;">malloc、new、calloc、realloc</td> <td style="text-align:left;">编译器管理</td></tr> <tr><td style="text-align:left;">分配效率</td> <td style="text-align:left;">低</td> <td style="text-align:left;">高</td></tr></tbody></table> <h3 id="堆和自由存储区的区别"><a href="#堆和自由存储区的区别" class="header-anchor">#</a> 堆和自由存储区的区别</h3> <p>自由存储区其实上是一个逻辑概念</p> <p>堆是物理概念。</p> <h3 id="malloc-free和new-delete的区别"><a href="#malloc-free和new-delete的区别" class="header-anchor">#</a> malloc/free和new/delete的区别</h3> <p>（1）new、delete是C++中的操作符，而malloc和free是标准库函数。操作符可以在类的内部重载，malloc/free不行，唯一的关联只是在默认情况下new/delete调用malloc/free</p> <p>（2）malloc/free(只是分配内存，不能执行构造函数，不能执行析构函数)，new/free。</p> <p>（3）new返回的是指定类型的指针，并且可以自动计算所申请内存的大小。而 malloc需要我们计算申请内存的大小，并且在返回时强行转换为实际类型的指针。</p> <h3 id="c-中new-delete的工作过程"><a href="#c-中new-delete的工作过程" class="header-anchor">#</a> C++中new/delete的工作过程</h3> <p><strong>申请的是普通的内置类型的空间：</strong></p> <p>（1）调用 C++标准库中 operator new函数，传入大小。（如果申请的是0byte则强制转化成1byte）</p> <p>（2）申请相对应的空间，如果没有足够的空间或其他问题且没有定义_new_hanlder，那么会抛出bad_alloc的异常并结束程序,如果定义了_new_hanlder回调函数，那么会一直不停的调用这个函数直到问题被解决为止</p> <p>（3）返回申请到的内存的首地址.</p> <p><strong>申请的是类空间：</strong></p> <p>（1）如果是申请的是0byte，强制转换为1byte</p> <p>（2）申请相对应的空间，如果没有足够的空间或其他问题且没有定义_new_hanlder，那么会抛出bad_alloc的异常并结束程序</p> <p>（3）如果定义了_new_hanlder回调函数，那么会一直不停的调用这个函数直到问题被解决为止。</p> <p>（4）如果这个类没有定义任何构造函数，析构函数，且编译器没有合成，那么下面的步骤跟申请普通的内置类型是一样的。</p> <p>（5）如果有构造函数或者析构函数，那么会调用一个库函数，具体什么库函数依编译器不同而不同，这个库函数会回调类的构造函数。</p> <p>（6）如果在构造函数中发生异常，那么会释放刚刚申请的空间并返回异常</p> <p>（7）返回申请到的内存的首地址</p> <p>delete 与new相反，会先调用析构函数再去释放内存（delete 实际调用 operator delete）</p> <p>operator new[]的形参是 sizeof(T)*N+4就是总大小加上一个4(用来保存个数);空间中前四个字节保存填充长度。然后执行N次operator new</p> <p>operator delete[] 类似；</p> <h2 id="参考文档"><a href="#参考文档" class="header-anchor">#</a> 参考文档</h2> <p><a href="https://zhuanlan.zhihu.com/p/434850899" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/434850899<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://blog.csdn.net/weixin_43340455/article/details/124786128" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/weixin_43340455/article/details/124786128<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/su-dd/blogwriter/edit/master/docs/编程语言--C++/20.深入理解/10.详解：C++内存分配.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="tags"><a href="/tags/?tag=%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D" title="标签">#内存分配</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2023/04/11, 22:32:26</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/8d1751/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">C++枚举和枚举类</div></a> <a href="/pages/f95db2/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">深入理解：变量、引用、指针</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/8d1751/" class="prev">C++枚举和枚举类</a></span> <span class="next"><a href="/pages/f95db2/">深入理解：变量、引用、指针</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/a038dc/"><div>
            NVM使用
            <!----></div></a> <span class="date">04-03</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/44f8a2/"><div>
            CMake详解
            <!----></div></a> <span class="date">04-03</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/6a3b4c/"><div>
            CMake简述
            <!----></div></a> <span class="date">04-03</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:987380454@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/su-dd" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2023
    <span>daidai | <a href="https://beian.miit.gov.cn/" target="_blank">皖ICP备2023000523号-1</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"><div></div><div></div><!----></div></div>
    <script src="/assets/js/app.b2b0617d.js" defer></script><script src="/assets/js/2.cff562a5.js" defer></script><script src="/assets/js/109.1b22a6eb.js" defer></script><script src="/assets/js/8.7397f135.js" defer></script>
  </body>
</html>
