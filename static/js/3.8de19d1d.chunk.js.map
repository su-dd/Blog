{"version":3,"sources":["../static/js/3.8de19d1d.chunk.js","components/Barrage/index.js","components/Barrage/utils.js","containers/MaskingDanmakuDemo/mockData.js","containers/MaskingDanmakuDemo/example.json","webpack:///./src/containers/MaskingDanmakuDemo/style.css?25fd","containers/MaskingDanmakuDemo/style.css","containers/MaskingDanmakuDemo/index.js"],"names":["webpackJsonp","1793","module","__webpack_exports__","__webpack_require__","_classCallCheck","instance","Constructor","TypeError","__WEBPACK_IMPORTED_MODULE_0__utils__","_slicedToArray","sliceIterator","arr","i","_arr","_n","_d","_e","undefined","_s","_i","Symbol","iterator","next","done","push","value","length","err","Array","isArray","Object","_createClass","defineProperties","target","props","descriptor","enumerable","configurable","writable","defineProperty","key","protoProps","staticProps","prototype","DEFAULT_CONFIG","duration","speed","fontSize","fontFamily","textShadowBlur","opacity","defaultColor","GLOBAL_MASK","type","mask","Barrage","_ref","container","_ref$data","data","_ref$config","config","_ref$overlapOptimized","overlapOptimized","_ref$mask","_ref$beforeRender","beforeRender","_ref$afterRender","afterRender","this","parent","document","getElementById","classList","add","canvas","createElement","className","width","clientWidth","height","clientHeight","style","pointerEvents","letterSpacing","appendChild","childNodes","position","left","top","ctx","getContext","setConfig","assign","setMask","setData","input","loadImage","then","img","toString","apply","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","entries","_ref2","_ref3","prop","return","rowCount","Math","floor","random","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","d","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_iterator3","x","abs","_randomTop","_this","prevData","map","_ref4","time","text","_ref4$fontSize","_ref4$fontFamily","_ref4$color","color","_ref4$createdAt","createdAt","Date","toISOString","some","find","font","_ctx$measureText","measureText","speedRatio","_optimizeData","_ref5","_ref5$fontSize","_ref5$fontFamily","_ref5$color","_ref5$createdAt","_ctx$measureText2","record","_this2","translateX","progress","clearRect","dataShown","filter","sort","a","b","animState","save","putImageData","drawImage","anotherCanvas","anotherContext","context","globalAlpha","shadowColor","shadowOffsetX","shadowOffsetY","shadowBlur","textBaseline","forEach","fillStyle","fillText","globalCompositeOperation","restore","animation","requestAnimationFrame","_render","_this3","pauseAt","startTime","now","goto","_play","cancelAnimationFrame","get","p","1794","url","picture","Image","src","Promise","resolve","reject","onload","onerror","window","mozRequestAnimationFrame","webkitRequestAnimationFrame","msRequestAnimationFrame","mozCancelAnimationFrame","1795","__WEBPACK_IMPORTED_MODULE_0__example_json__","__WEBPACK_IMPORTED_MODULE_0__example_json___default","n","randomKey","fill","slice","join","colors","randomColor","randomText","example","createdStart","database","1796","exports","1797","content","options","transform","locals","1798","version","sources","names","mappings","file","sourcesContent","sourceRoot","482","_possibleConstructorReturn","self","call","ReferenceError","_inherits","subClass","superClass","create","constructor","setPrototypeOf","__proto__","__WEBPACK_IMPORTED_MODULE_0_react__","__WEBPACK_IMPORTED_MODULE_0_react___default","__WEBPACK_IMPORTED_MODULE_1_components_Barrage__","__WEBPACK_IMPORTED_MODULE_2__mockData__","__WEBPACK_IMPORTED_MODULE_3__style_css__","videoSize","MaskingDanmakuDemo","_Component","getPrototypeOf","arguments","barrage","vCanvas","vContext","video","frame","getImageData","pxCount","r","g","addEventListener","play","pause","currentTime","ref","controls","Component"],"mappings":"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","file":"static/js/3.8de19d1d.chunk.js","sourcesContent":["webpackJsonp([3],{\n\n/***/ 1793:\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__utils__ = __webpack_require__(1794);\nvar _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally{try{if(!_n&&_i[\"return\"])_i[\"return\"]();}finally{if(_d)throw _e;}}return _arr;}return function(arr,i){if(Array.isArray(arr)){return arr;}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i);}else{throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");}};}();var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if(\"value\"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError(\"Cannot call a class as a function\");}}// 支持通过 barrage.setConfig() 接口修改的配置项\nvar DEFAULT_CONFIG={duration:-1,// -1 表示不循环播放\nspeed:100,fontSize:24,fontFamily:'Microsoft Yahei',textShadowBlur:1.0,opacity:1.0,defaultColor:'#fff'};// 蒙版信息\nvar GLOBAL_MASK={type:null,// 蒙版类型：'url' 'ImageData'\nmask:null// 蒙版数据：ImageData\n};/**\r\n * 弹幕组件 Barrage\r\n * @param {string/element} container 弹幕的挂载点\r\n * @param {array} data 弹幕数据，单条数据格式如 { time: 1200, text: '2333' }\r\n * @param {number} config.duration 弹幕的循环周期(不设置此参数时，默认弹幕仅播放一次)，单位：毫秒\r\n * @param {number} config.speed 弹幕最小移动速度，单位：像素/秒\r\n * @param {number} config.fontSize 文字大小，单位：像素\r\n * @param {string} config.fontFamily 字体\r\n * @param {number} config.textShadowBlur 字体阴影扩散系数，取值范围：[0, 1]\r\n * @param {number} config.opacity 字体透明度，取值范围：[0, 1]\r\n * @param {string} config.defaultColor 字体默认颜色\r\n * @param {boolean} overlapOptimized 弹幕装填时是否启用布局优化(以尽可能避免使相邻时间的弹幕重叠)，默认值：false\r\n * @param {string/ImageData} mask 蒙版图像信息，每 4 个元素表示一个像素的 RGBA 信息\r\n * @param {function} beforeRender 帧渲染前的钩子\r\n * @param {function} afterRender 帧渲染后的钩子\r\n */var Barrage=function(){function Barrage(_ref){var container=_ref.container,_ref$data=_ref.data,data=_ref$data===undefined?[]:_ref$data,_ref$config=_ref.config,config=_ref$config===undefined?{}:_ref$config,_ref$overlapOptimized=_ref.overlapOptimized,overlapOptimized=_ref$overlapOptimized===undefined?false:_ref$overlapOptimized,_ref$mask=_ref.mask,mask=_ref$mask===undefined?[]:_ref$mask,_ref$beforeRender=_ref.beforeRender,beforeRender=_ref$beforeRender===undefined?function(){}:_ref$beforeRender,_ref$afterRender=_ref.afterRender,afterRender=_ref$afterRender===undefined?function(){}:_ref$afterRender;_classCallCheck(this,Barrage);// 获取父级容器\nthis.parent=typeof container==='string'?document.getElementById(container):container;this.parent.classList.add('barrage-container');// 创建画布\nthis.canvas=document.createElement('canvas');this.canvas.className='barrage-canvas';this.canvas.width=this.parent.clientWidth;this.canvas.height=this.parent.clientHeight;this.canvas.style.pointerEvents='none';// canvas 事件穿透\nthis.canvas.style.letterSpacing='1.5px';// canvas 字符间距\nthis.parent.appendChild(this.canvas);// 若父节点存在其他子节点，则设置画布为绝对定位\nif(this.parent.childNodes.length>1){this.parent.style.position='relative';this.canvas.style.position='absolute';this.canvas.style.left='0px';this.canvas.style.top='0px';}// 画布上下文\nthis.ctx=this.canvas.getContext('2d');// 弹幕装填时是否启用布局优化\nthis.overlapOptimized=overlapOptimized;// 全局参数设置\nthis.setConfig(Object.assign({},DEFAULT_CONFIG,config));this.setMask(mask);// 设置蒙版\nthis.beforeRender=beforeRender;this.afterRender=afterRender;// 数据初始化\nthis.setData(data);}_createClass(Barrage,[{key:'setMask',value:function setMask(input){if(typeof input==='string'){GLOBAL_MASK.type='url';Object(__WEBPACK_IMPORTED_MODULE_0__utils__[\"b\" /* loadImage */])(input).then(function(img){GLOBAL_MASK.data=img;});}else if(Object.prototype.toString.apply(input)==='[object ImageData]'){GLOBAL_MASK.type='ImageData';GLOBAL_MASK.data=input;}else{GLOBAL_MASK.type=null;GLOBAL_MASK.data=null;}}},{key:'clearMask',value:function clearMask(){this.setMask();}},{key:'setConfig',value:function setConfig(config){if(!this.config)this.config={};var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=Object.entries(config)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _ref2=_step.value;var _ref3=_slicedToArray(_ref2,2);var prop=_ref3[0];var value=_ref3[1];if(DEFAULT_CONFIG[prop])this.config[prop]=value;}}catch(err){_didIteratorError=true;_iteratorError=err;}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally{if(_didIteratorError){throw _iteratorError;}}}}},{key:'_randomTop',value:function _randomTop(){var LINE_HEIGHT=1.32;// 计算大致的行数\nthis.rowCount=this.rowCount||Math.floor(this.canvas.height/(LINE_HEIGHT*this.config.fontSize));// 随机产生纵向位置\nvar randomTop=this.config.fontSize*(LINE_HEIGHT-1)/2+Math.floor(this.rowCount*Math.random())*LINE_HEIGHT*this.config.fontSize;return randomTop;}},{key:'_optimizeData',value:function _optimizeData(){// 尽量避免文字重叠\nif(this.data){var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this.data[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var d=_step2.value;var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=this.data[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var x=_step3.value;var hasOverlap=Math.abs(x.top-d.top)<this.config.fontSize*0.1&&x.left>=d.left&&x.left<=d.left+d.width||Math.abs(x.top-d.top)<this.config.fontSize*0.1&&x.left+x.width>=d.left&&x.left+x.width<=d.left+d.width;if(hasOverlap){x.top=this._randomTop();}}}catch(err){_didIteratorError3=true;_iteratorError3=err;}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return();}}finally{if(_didIteratorError3){throw _iteratorError3;}}}}}catch(err){_didIteratorError2=true;_iteratorError2=err;}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return();}}finally{if(_didIteratorError2){throw _iteratorError2;}}}}}},{key:'setData',value:function setData(data){var _this=this;// 保存上一次数据集\nif(this.data)this.prevData=this.data;// 获取弹幕数据并计算出布局信息\nthis.data=data.map(function(_ref4){var key=_ref4.key,time=_ref4.time,text=_ref4.text,_ref4$fontSize=_ref4.fontSize,fontSize=_ref4$fontSize===undefined?_this.config.fontSize:_ref4$fontSize,_ref4$fontFamily=_ref4.fontFamily,fontFamily=_ref4$fontFamily===undefined?_this.config.fontFamily:_ref4$fontFamily,_ref4$color=_ref4.color,color=_ref4$color===undefined?_this.config.defaultColor:_ref4$color,_ref4$createdAt=_ref4.createdAt,createdAt=_ref4$createdAt===undefined?new Date().toISOString():_ref4$createdAt;// 若上一次数据集中已存在该数据，则直接保留\nif(_this.prevData&&_this.prevData.some(function(d){return d.key===key;})){return _this.prevData.find(function(d){return d.key===key;});}// 弹幕布局\n_this.ctx.font=fontSize+'px '+fontFamily;var _ctx$measureText=_this.ctx.measureText(text),width=_ctx$measureText.width;return{key:key,time:time,text:text,fontSize:fontSize,fontFamily:fontFamily,color:color,createdAt:createdAt,left:_this.config.speed*time/1000+_this.canvas.width,top:_this._randomTop(),width:width,height:_this.config.fontSize,speedRatio:Math.random()+1};});if(this.overlapOptimized)this._optimizeData();}},{key:'add',value:function add(_ref5){var time=_ref5.time,text=_ref5.text,_ref5$fontSize=_ref5.fontSize,fontSize=_ref5$fontSize===undefined?this.config.fontSize:_ref5$fontSize,_ref5$fontFamily=_ref5.fontFamily,fontFamily=_ref5$fontFamily===undefined?this.config.fontFamily:_ref5$fontFamily,_ref5$color=_ref5.color,color=_ref5$color===undefined?this.config.defaultColor:_ref5$color,_ref5$createdAt=_ref5.createdAt,createdAt=_ref5$createdAt===undefined?new Date().toISOString():_ref5$createdAt;this.ctx.font=fontSize+'px '+fontFamily;var _ctx$measureText2=this.ctx.measureText(text),width=_ctx$measureText2.width;var record={time:time,text:text,fontSize:fontSize,fontFamily:fontFamily,color:color,createdAt:createdAt,left:this.config.speed*time/1000+this.canvas.width,top:this._randomTop(),width:width,height:this.config.fontSize,speedRatio:Math.random()+1};if(this.data&&this.data.length){this.data.push(record);}else{this.setData([record]);}}// 计算播放进度，单位：毫秒\n},{key:'_render',value:function _render(){var _this2=this;// 弹幕整体向左移动的总距离\nvar translateX=this.config.speed*this.progress/1000;// 清空画布\nthis.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);// 筛选待渲染的数据\nvar dataShown=this.data.filter(function(x){return x.left+x.width-translateX*x.speedRatio>=0&&x.left-translateX*x.speedRatio<_this2.canvas.width;}).sort(function(a,b){return new Date(a.createdAt)-new Date(b.createdAt);});// 执行渲染前的回调\nif(this.beforeRender)this.beforeRender(this.ctx,this.progress,this.animState);this.ctx.save();if(GLOBAL_MASK.data){if(GLOBAL_MASK.type==='ImageData'){this.ctx.putImageData(GLOBAL_MASK.data,0,0);}else if(GLOBAL_MASK.type==='url'){this.ctx.drawImage(GLOBAL_MASK.data,0,0,this.canvas.width,this.canvas.height);}if(!this.anotherCanvas){this.anotherCanvas=document.createElement('canvas');this.anotherCanvas.width=this.canvas.width;this.anotherCanvas.height=this.canvas.height;this.anotherContext=this.anotherCanvas.getContext('2d');}else{this.anotherContext.clearRect(0,0,this.anotherCanvas.width,this.anotherCanvas.height);}}// 绘制数据\nvar context=GLOBAL_MASK.data?this.anotherContext:this.ctx;context.globalAlpha=this.config.opacity;context.shadowColor='rgba(0, 0, 0, 1)';context.shadowOffsetX=0;context.shadowOffsetY=0;context.shadowBlur=this.config.textShadowBlur*2;context.textBaseline='top';dataShown.forEach(function(d){context.font=d.fontSize+'px '+d.fontFamily;context.fillStyle=d.color;context.fillText(d.text,d.left-translateX*d.speedRatio,d.top);});if(GLOBAL_MASK.data){this.ctx.globalCompositeOperation='source-in';this.ctx.drawImage(this.anotherCanvas,0,0,this.canvas.width,this.canvas.height);}this.ctx.restore();// 执行渲染后的回调\nif(this.afterRender)this.afterRender(this.ctx,this.progress,this.animState);// 执行下一帧\nif(this.animation)Object(__WEBPACK_IMPORTED_MODULE_0__utils__[\"c\" /* requestAnimationFrame */])(function(){return _this2._render();});}},{key:'_play',value:function _play(){var _this3=this;// 创建动画任务\nif(!this.animation)this.animation=Object(__WEBPACK_IMPORTED_MODULE_0__utils__[\"c\" /* requestAnimationFrame */])(function(){return _this3._render();});}},{key:'goto',value:function goto(progress){if(this.pauseAt!==undefined)this.pauseAt=undefined;this.startTime=Date.now()-progress;if(!this.animation)this._render();}},{key:'play',value:function play(){if(!this.startTime)this.startTime=Date.now();if(this.pauseAt!==undefined){this.goto(this.pauseAt);this.pauseAt=undefined;}this._play();}},{key:'replay',value:function replay(){this.startTime=Date.now();if(this.pauseAt!==undefined)this.pauseAt=undefined;this._play();}},{key:'pause',value:function pause(){if(this.animation){Object(__WEBPACK_IMPORTED_MODULE_0__utils__[\"a\" /* cancelAnimationFrame */])(this.animation);this.animation=undefined;// 保存暂停时的进度\nthis.pauseAt=Date.now()-this.startTime;}}},{key:'progress',get:function get(){if(!this.startTime)return 0;if(this.pauseAt!==undefined)return this.pauseAt;var p=Date.now()-this.startTime;if(this.config.duration>0)p%=this.config.duration;return p;}// 获取当前播放状态\n},{key:'animState',get:function get(){if(!this.startTime)return'ready';return this.pauseAt!==undefined?'paused':'playing';}}]);return Barrage;}();/* harmony default export */ __webpack_exports__[\"a\"] = (Barrage);\n\n/***/ }),\n\n/***/ 1794:\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"b\", function() { return loadImage; });\n/* unused harmony export getImageData */\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"c\", function() { return requestAnimationFrame; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return cancelAnimationFrame; });\nvar loadImage=function loadImage(url){var picture=new Image();picture.src=url;return new Promise(function(resolve,reject){picture.onload=function(){resolve(picture);};picture.onerror=function(){reject();};});};var getImageData=function getImageData(url,renderWidth,renderHeight,dx,dy,dw,dh){return loadImage(url).then(function(picture){var imgViewer=document.createElement('canvas');imgViewer.width=renderWidth||picture.width;imgViewer.height=renderHeight||picture.height;var context=imgViewer.getContext('2d');context.drawImage(picture,0,0,imgViewer.width,imgViewer.height);return context.getImageData(dx||0,dy||0,dw||imgViewer.width,dh||imgViewer.height);});};var requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;var cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame;\n\n/***/ }),\n\n/***/ 1795:\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__example_json__ = __webpack_require__(1796);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__example_json___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0__example_json__);\nvar randomKey=function randomKey(){return new Array(2).fill(0).map(function(){return Math.random().toString(32).slice(2);}).join('');};var colors=['#f00','#0f0','#ff0','#fff','#fff','#fff','#fff'];var randomColor=function randomColor(){return colors[Math.floor(6*Math.random())];};var randomText=function randomText(){return __WEBPACK_IMPORTED_MODULE_0__example_json___default.a[Math.floor(__WEBPACK_IMPORTED_MODULE_0__example_json___default.a.length*Math.random())].text;};var createdStart=Date.now();var database=new Array(5000).fill(null).map(function(d,i){return{key:randomKey(),time:200*(i+Math.random()),text:randomText(),color:randomColor(),createdAt:createdStart+Math.random()*24*3600*1000};});/* harmony default export */ __webpack_exports__[\"a\"] = (database);\n\n/***/ }),\n\n/***/ 1796:\n/***/ (function(module, exports) {\n\nmodule.exports = [{\"key\":\"7g43mm0rpp1l67eh6qjo8\",\"time\":500,\"text\":\"绿色走一波\",\"color\":\"#0f0\",\"createdAt\":\"2019-01-13T13:34:47.126Z\"},{\"key\":\"n8alq5l22d8qqbuhgst68g\",\"time\":1200,\"text\":\"我膨胀了\",\"fontFamily\":\"SimSun\",\"fontSize\":32,\"color\":\"yellow\",\"createdAt\":\"2019-01-13T13:34:47.126Z\"},{\"key\":\"atb8ctt81egh8hf45u7n2g\",\"time\":2500,\"text\":\"妈妈咪呀\",\"createdAt\":\"2019-01-13T13:34:47.126Z\"},{\"key\":\"bl9a602defoehsiahgi7vo\",\"time\":3300,\"text\":\"富贵使我们相遇\",\"createdAt\":\"2019-01-13T13:34:47.126Z\"},{\"key\":\"p0su7gh4s88fjtqv0bmdog\",\"time\":4000,\"text\":\"要想生活过得去\",\"color\":\"#0f0\",\"createdAt\":\"2019-01-13T13:34:47.126Z\"},{\"key\":\"udfel3ppv5ggrfqo4nlbng\",\"time\":4400,\"text\":\"你且在这里不要走动，待我去买两斤橘子\",\"color\":\"#f00\",\"createdAt\":\"2019-01-13T13:34:47.126Z\"},{\"key\":\"68ts93rle7gtv1i9die5ig\",\"time\":4800,\"text\":\"我们都一样\",\"createdAt\":\"2019-01-13T13:34:47.126Z\"},{\"key\":\"dcprmrcmdcg4btqej0mung\",\"time\":5200,\"text\":\"Remember me\",\"createdAt\":\"2019-01-13T13:34:47.126Z\"},{\"key\":\"9jgn02iii6b8qmkq2v2hg\",\"time\":5680,\"text\":\"LoL\",\"createdAt\":\"2019-01-13T13:34:47.126Z\"},{\"key\":\"im73i1lka0ooavb86gb048\",\"time\":6600,\"text\":\"(-_-)|||\",\"createdAt\":\"2019-01-13T13:34:47.126Z\"},{\"key\":\"hrbvbcuekoqm7aacufgk8\",\"time\":7200,\"text\":\"天哪噜\",\"createdAt\":\"2019-01-13T13:34:47.126Z\"},{\"key\":\"f95vsgh50qob6ip3r617b\",\"time\":8300,\"text\":\"富强 民主 文明 和谐 自由 平等 公正 法治 爱国 敬业 诚信 友善\",\"color\":\"#f00\",\"createdAt\":\"2019-01-13T13:34:47.126Z\"},{\"key\":\"u7bo393jvv8dkccb2ml0e\",\"time\":9210,\"text\":\"啦啦啦啦啦啦啦拉\",\"createdAt\":\"2019-01-13T13:34:47.126Z\"},{\"key\":\"muafgllnsg20op35brg9\",\"time\":10000,\"text\":\"我是谁 我从哪里来 我为什么要看这个\",\"createdAt\":\"2019-01-13T13:34:47.126Z\"},{\"key\":\"hjv3sllm12tbh85r2qor8\",\"time\":12000,\"text\":\"2333333333333333\",\"createdAt\":\"2019-01-13T13:34:47.126Z\"},{\"key\":\"r7u5mvu1l7g1hk7cvnddig\",\"time\":12000,\"text\":\"2333333333333333\",\"createdAt\":\"2019-01-13T13:34:47.126Z\"},{\"key\":\"0o51j9psnj8qn3bnfq9kag\",\"time\":12000,\"text\":\"2333333333333333\",\"createdAt\":\"2019-01-13T13:34:47.126Z\"},{\"key\":\"fkgm2nerakgr71jloi9d38\",\"time\":12000,\"text\":\"2333333333333333\",\"createdAt\":\"2019-01-13T13:34:47.126Z\"}]\n\n/***/ }),\n\n/***/ 1797:\n/***/ (function(module, exports, __webpack_require__) {\n\n// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = __webpack_require__(1798);\nif(typeof content === 'string') content = [[module.i, content, '']];\n// Prepare cssTransformation\nvar transform;\n\nvar options = {}\noptions.transform = transform\n// add the styles to the DOM\nvar update = __webpack_require__(478)(content, options);\nif(content.locals) module.exports = content.locals;\n// Hot Module Replacement\nif(false) {\n\t// When the styles change, update the <style> tags\n\tif(!content.locals) {\n\t\tmodule.hot.accept(\"!!../../../node_modules/css-loader/index.js??ref--1-oneOf-2-2!../../../node_modules/postcss-loader/lib/index.js??postcss!./style.css\", function() {\n\t\t\tvar newContent = require(\"!!../../../node_modules/css-loader/index.js??ref--1-oneOf-2-2!../../../node_modules/postcss-loader/lib/index.js??postcss!./style.css\");\n\t\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\t\t\tupdate(newContent);\n\t\t});\n\t}\n\t// When the module is disposed, remove the <style> tags\n\tmodule.hot.dispose(function() { update(); });\n}\n\n/***/ }),\n\n/***/ 1798:\n/***/ (function(module, exports, __webpack_require__) {\n\nexports = module.exports = __webpack_require__(477)(true);\n// imports\n\n\n// module\nexports.push([module.i, \".danmaku-container,.danmaku-video{width:880px;height:540px}.danmaku-container{margin:0 auto;margin-top:50vh;margin-left:50vw;-webkit-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);transform:translate(-50%,-50%);background-color:#ddd}.danmaku-video::-webkit-media-controls-fullscreen-button{display:none}\", \"\", {\"version\":3,\"sources\":[\"E:/GitHub/Blog/src/containers/MaskingDanmakuDemo/style.css\"],\"names\":[],\"mappings\":\"AAAA,kCAEE,YAAa,AACb,YAAc,CACf,AAED,mBACE,cAAe,AACf,gBAAiB,AACjB,iBAAkB,AAClB,uCAAyC,AACrC,mCAAqC,AACjC,+BAAiC,AACzC,qBAAuB,CACxB,AAED,yDACE,YAAc,CACf\",\"file\":\"style.css\",\"sourcesContent\":[\".danmaku-container,\\r\\n.danmaku-video {\\r\\n  width: 880px;\\r\\n  height: 540px;\\r\\n}\\r\\n\\r\\n.danmaku-container {\\r\\n  margin: 0 auto;\\r\\n  margin-top: 50vh;\\r\\n  margin-left: 50vw;\\r\\n  -webkit-transform: translate(-50%, -50%);\\r\\n      -ms-transform: translate(-50%, -50%);\\r\\n          transform: translate(-50%, -50%);\\r\\n  background-color: #ddd;\\r\\n}\\r\\n\\r\\n.danmaku-video::-webkit-media-controls-fullscreen-button {\\r\\n  display: none;\\r\\n}\\r\\n\"],\"sourceRoot\":\"\"}]);\n\n// exports\n\n\n/***/ }),\n\n/***/ 482:\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nObject.defineProperty(__webpack_exports__, \"__esModule\", { value: true });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_react__ = __webpack_require__(6);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_react___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_react__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_components_Barrage__ = __webpack_require__(1793);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__mockData__ = __webpack_require__(1795);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__style_css__ = __webpack_require__(1797);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__style_css___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3__style_css__);\nvar _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if(\"value\"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError(\"Cannot call a class as a function\");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");}return call&&(typeof call===\"object\"||typeof call===\"function\")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!==\"function\"&&superClass!==null){throw new TypeError(\"Super expression must either be null or a function, not \"+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}var videoSize={width:880,height:540};var MaskingDanmakuDemo=function(_Component){_inherits(MaskingDanmakuDemo,_Component);function MaskingDanmakuDemo(){_classCallCheck(this,MaskingDanmakuDemo);return _possibleConstructorReturn(this,(MaskingDanmakuDemo.__proto__||Object.getPrototypeOf(MaskingDanmakuDemo)).apply(this,arguments));}_createClass(MaskingDanmakuDemo,[{key:'componentDidMount',value:function componentDidMount(){var _this2=this;// 创建弹幕实例\nvar barrage=new __WEBPACK_IMPORTED_MODULE_1_components_Barrage__[\"a\" /* default */]({container:this.container,config:{overlapOptimized:true}});// 重置画布高度，避免弹幕遮挡视频播放控件\nbarrage.canvas.width=videoSize.width;barrage.canvas.height=videoSize.height-80;barrage.setData(__WEBPACK_IMPORTED_MODULE_2__mockData__[\"a\" /* default */]);// 新建一个画布来实时绘制视频（纯绘图，不用添加进页面）\nvar vCanvas=document.createElement('canvas');vCanvas.width=videoSize.width;vCanvas.height=videoSize.height;var vContext=vCanvas.getContext('2d');// 实时绘制视频到画布\nbarrage.afterRender=function(){vContext.drawImage(_this2.video,0,0,vCanvas.width,vCanvas.height);};// 渲染前读取画布 vCanvas 的数据，并处理为蒙版图像\nbarrage.beforeRender=function(){// 读取图像\nvar frame=vContext.getImageData(0,0,vCanvas.width,vCanvas.height);// 图像总像素个数\nvar pxCount=frame.data.length/4;// 将 frame 构造成我们需要的蒙版图像\nfor(var i=0;i<pxCount;i++){// 这里不用 ES6 解构赋值的写法，主要为了保证计算性能\nvar r=frame.data[i*4+0];var g=frame.data[i*4+1];var b=frame.data[i*4+2];// 将黑色区域以外的内容设为透明\nif(r>15||g>15||b>15){frame.data[4*i+3]=0;}}// 设置蒙版\nbarrage.setMask(frame);};// 绑定播放事件\nthis.video.addEventListener('play',function(){barrage.play();},false);// 绑定暂停事件\nthis.video.addEventListener('pause',function(){barrage.pause();},false);// 播放进度事件\nthis.video.addEventListener('seeked',function(){barrage.goto(_this2.video.currentTime*1000);},false);}},{key:'render',value:function render(){var _this3=this;return __WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement('div',{className:'danmaku-container',ref:function ref(_ref2){_this3.container=_ref2;}},__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement('video',{className:'danmaku-video',ref:function ref(_ref){_this3.video=_ref;},src:'videos/demo.mp4',controls:true}));}}]);return MaskingDanmakuDemo;}(__WEBPACK_IMPORTED_MODULE_0_react__[\"Component\"]);/* harmony default export */ __webpack_exports__[\"default\"] = (MaskingDanmakuDemo);\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// static/js/3.8de19d1d.chunk.js","import {\r\n  requestAnimationFrame,\r\n  cancelAnimationFrame,\r\n  loadImage,\r\n} from './utils';\r\n\r\n// 支持通过 barrage.setConfig() 接口修改的配置项\r\nconst DEFAULT_CONFIG = {\r\n  duration: -1, // -1 表示不循环播放\r\n  speed: 100,\r\n  fontSize: 24,\r\n  fontFamily: 'Microsoft Yahei',\r\n  textShadowBlur: 1.0,\r\n  opacity: 1.0,\r\n  defaultColor: '#fff',\r\n};\r\n\r\n// 蒙版信息\r\nconst GLOBAL_MASK = {\r\n  type: null, // 蒙版类型：'url' 'ImageData'\r\n  mask: null, // 蒙版数据：ImageData\r\n};\r\n\r\n/**\r\n * 弹幕组件 Barrage\r\n * @param {string/element} container 弹幕的挂载点\r\n * @param {array} data 弹幕数据，单条数据格式如 { time: 1200, text: '2333' }\r\n * @param {number} config.duration 弹幕的循环周期(不设置此参数时，默认弹幕仅播放一次)，单位：毫秒\r\n * @param {number} config.speed 弹幕最小移动速度，单位：像素/秒\r\n * @param {number} config.fontSize 文字大小，单位：像素\r\n * @param {string} config.fontFamily 字体\r\n * @param {number} config.textShadowBlur 字体阴影扩散系数，取值范围：[0, 1]\r\n * @param {number} config.opacity 字体透明度，取值范围：[0, 1]\r\n * @param {string} config.defaultColor 字体默认颜色\r\n * @param {boolean} overlapOptimized 弹幕装填时是否启用布局优化(以尽可能避免使相邻时间的弹幕重叠)，默认值：false\r\n * @param {string/ImageData} mask 蒙版图像信息，每 4 个元素表示一个像素的 RGBA 信息\r\n * @param {function} beforeRender 帧渲染前的钩子\r\n * @param {function} afterRender 帧渲染后的钩子\r\n */\r\nexport default class Barrage {\r\n  constructor({\r\n    container,\r\n    data = [],\r\n    config = {},\r\n    overlapOptimized = false,\r\n    mask = [],\r\n    beforeRender = () => {},\r\n    afterRender = () => {},\r\n  }) {\r\n    // 获取父级容器\r\n    this.parent =\r\n      typeof container === 'string'\r\n        ? document.getElementById(container)\r\n        : container;\r\n    this.parent.classList.add('barrage-container');\r\n\r\n    // 创建画布\r\n    this.canvas = document.createElement('canvas');\r\n    this.canvas.className = 'barrage-canvas';\r\n    this.canvas.width = this.parent.clientWidth;\r\n    this.canvas.height = this.parent.clientHeight;\r\n    this.canvas.style.pointerEvents = 'none'; // canvas 事件穿透\r\n    this.canvas.style.letterSpacing = '1.5px'; // canvas 字符间距\r\n    this.parent.appendChild(this.canvas);\r\n\r\n    // 若父节点存在其他子节点，则设置画布为绝对定位\r\n    if (this.parent.childNodes.length > 1) {\r\n      this.parent.style.position = 'relative';\r\n      this.canvas.style.position = 'absolute';\r\n      this.canvas.style.left = '0px';\r\n      this.canvas.style.top = '0px';\r\n    }\r\n\r\n    // 画布上下文\r\n    this.ctx = this.canvas.getContext('2d');\r\n\r\n    // 弹幕装填时是否启用布局优化\r\n    this.overlapOptimized = overlapOptimized;\r\n\r\n    // 全局参数设置\r\n    this.setConfig({\r\n      ...DEFAULT_CONFIG,\r\n      ...config,\r\n    });\r\n\r\n    this.setMask(mask); // 设置蒙版\r\n    this.beforeRender = beforeRender;\r\n    this.afterRender = afterRender;\r\n\r\n    // 数据初始化\r\n    this.setData(data);\r\n  }\r\n\r\n  setMask(input) {\r\n    if (typeof input === 'string') {\r\n      GLOBAL_MASK.type = 'url';\r\n      loadImage(input).then(img => {\r\n        GLOBAL_MASK.data = img;\r\n      });\r\n    } else if (\r\n      Object.prototype.toString.apply(input) === '[object ImageData]'\r\n    ) {\r\n      GLOBAL_MASK.type = 'ImageData';\r\n      GLOBAL_MASK.data = input;\r\n    } else {\r\n      GLOBAL_MASK.type = null;\r\n      GLOBAL_MASK.data = null;\r\n    }\r\n  }\r\n\r\n  clearMask() {\r\n    this.setMask();\r\n  }\r\n\r\n  setConfig(config) {\r\n    if (!this.config) this.config = {};\r\n\r\n    for (let [prop, value] of Object.entries(config)) {\r\n      if (DEFAULT_CONFIG[prop]) this.config[prop] = value;\r\n    }\r\n  }\r\n\r\n  _randomTop() {\r\n    const LINE_HEIGHT = 1.32;\r\n\r\n    // 计算大致的行数\r\n    this.rowCount =\r\n      this.rowCount ||\r\n      Math.floor(this.canvas.height / (LINE_HEIGHT * this.config.fontSize));\r\n\r\n    // 随机产生纵向位置\r\n    const randomTop =\r\n      (this.config.fontSize * (LINE_HEIGHT - 1)) / 2 +\r\n      Math.floor(this.rowCount * Math.random()) *\r\n        LINE_HEIGHT *\r\n        this.config.fontSize;\r\n\r\n    return randomTop;\r\n  }\r\n\r\n  _optimizeData() {\r\n    // 尽量避免文字重叠\r\n    if (this.data) {\r\n      for (let d of this.data) {\r\n        for (let x of this.data) {\r\n          const hasOverlap =\r\n            (Math.abs(x.top - d.top) < this.config.fontSize * 0.1 &&\r\n              x.left >= d.left &&\r\n              x.left <= d.left + d.width) ||\r\n            (Math.abs(x.top - d.top) < this.config.fontSize * 0.1 &&\r\n              x.left + x.width >= d.left &&\r\n              x.left + x.width <= d.left + d.width);\r\n\r\n          if (hasOverlap) {\r\n            x.top = this._randomTop();\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  setData(data) {\r\n    // 保存上一次数据集\r\n    if (this.data) this.prevData = this.data;\r\n\r\n    // 获取弹幕数据并计算出布局信息\r\n    this.data = data.map(\r\n      ({\r\n        key,\r\n        time,\r\n        text,\r\n        fontSize = this.config.fontSize,\r\n        fontFamily = this.config.fontFamily,\r\n        color = this.config.defaultColor,\r\n        createdAt = new Date().toISOString(),\r\n      }) => {\r\n        // 若上一次数据集中已存在该数据，则直接保留\r\n        if (this.prevData && this.prevData.some(d => d.key === key)) {\r\n          return this.prevData.find(d => d.key === key);\r\n        }\r\n\r\n        // 弹幕布局\r\n        this.ctx.font = `${fontSize}px ${fontFamily}`;\r\n        const { width } = this.ctx.measureText(text);\r\n\r\n        return {\r\n          key,\r\n          time,\r\n          text,\r\n          fontSize,\r\n          fontFamily,\r\n          color,\r\n          createdAt,\r\n          left: (this.config.speed * time) / 1000 + this.canvas.width,\r\n          top: this._randomTop(),\r\n          width,\r\n          height: this.config.fontSize,\r\n          speedRatio: Math.random() + 1,\r\n        };\r\n      }\r\n    );\r\n\r\n    if (this.overlapOptimized) this._optimizeData();\r\n  }\r\n\r\n  add({\r\n    time,\r\n    text,\r\n    fontSize = this.config.fontSize,\r\n    fontFamily = this.config.fontFamily,\r\n    color = this.config.defaultColor,\r\n    createdAt = new Date().toISOString(),\r\n  }) {\r\n    this.ctx.font = `${fontSize}px ${fontFamily}`;\r\n    const { width } = this.ctx.measureText(text);\r\n\r\n    const record = {\r\n      time,\r\n      text,\r\n      fontSize,\r\n      fontFamily,\r\n      color,\r\n      createdAt,\r\n      left: (this.config.speed * time) / 1000 + this.canvas.width,\r\n      top: this._randomTop(),\r\n      width,\r\n      height: this.config.fontSize,\r\n      speedRatio: Math.random() + 1,\r\n    };\r\n\r\n    if (this.data && this.data.length) {\r\n      this.data.push(record);\r\n    } else {\r\n      this.setData([record]);\r\n    }\r\n  }\r\n\r\n  // 计算播放进度，单位：毫秒\r\n  get progress() {\r\n    if (!this.startTime) return 0;\r\n    if (this.pauseAt !== undefined) return this.pauseAt;\r\n\r\n    let p = Date.now() - this.startTime;\r\n    if (this.config.duration > 0) p %= this.config.duration;\r\n\r\n    return p;\r\n  }\r\n\r\n  // 获取当前播放状态\r\n  get animState() {\r\n    if (!this.startTime) return 'ready';\r\n    return this.pauseAt !== undefined ? 'paused' : 'playing';\r\n  }\r\n\r\n  _render() {\r\n    // 弹幕整体向左移动的总距离\r\n    const translateX = (this.config.speed * this.progress) / 1000;\r\n\r\n    // 清空画布\r\n    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n\r\n    // 筛选待渲染的数据\r\n    const dataShown = this.data\r\n      .filter(\r\n        x =>\r\n          x.left + x.width - translateX * x.speedRatio >= 0 &&\r\n          x.left - translateX * x.speedRatio < this.canvas.width\r\n      )\r\n      .sort((a, b) => new Date(a.createdAt) - new Date(b.createdAt));\r\n\r\n    // 执行渲染前的回调\r\n    if (this.beforeRender)\r\n      this.beforeRender(this.ctx, this.progress, this.animState);\r\n\r\n    this.ctx.save();\r\n    if (GLOBAL_MASK.data) {\r\n      if (GLOBAL_MASK.type === 'ImageData') {\r\n        this.ctx.putImageData(GLOBAL_MASK.data, 0, 0);\r\n      } else if (GLOBAL_MASK.type === 'url') {\r\n        this.ctx.drawImage(\r\n          GLOBAL_MASK.data,\r\n          0,\r\n          0,\r\n          this.canvas.width,\r\n          this.canvas.height\r\n        );\r\n      }\r\n\r\n      if (!this.anotherCanvas) {\r\n        this.anotherCanvas = document.createElement('canvas');\r\n        this.anotherCanvas.width = this.canvas.width;\r\n        this.anotherCanvas.height = this.canvas.height;\r\n        this.anotherContext = this.anotherCanvas.getContext('2d');\r\n      } else {\r\n        this.anotherContext.clearRect(\r\n          0,\r\n          0,\r\n          this.anotherCanvas.width,\r\n          this.anotherCanvas.height\r\n        );\r\n      }\r\n    }\r\n\r\n    // 绘制数据\r\n    const context = GLOBAL_MASK.data ? this.anotherContext : this.ctx;\r\n    context.globalAlpha = this.config.opacity;\r\n    context.shadowColor = 'rgba(0, 0, 0, 1)';\r\n    context.shadowOffsetX = 0;\r\n    context.shadowOffsetY = 0;\r\n    context.shadowBlur = this.config.textShadowBlur * 2;\r\n    context.textBaseline = 'top';\r\n    dataShown.forEach(d => {\r\n      context.font = `${d.fontSize}px ${d.fontFamily}`;\r\n      context.fillStyle = d.color;\r\n      context.fillText(d.text, d.left - translateX * d.speedRatio, d.top);\r\n    });\r\n\r\n    if (GLOBAL_MASK.data) {\r\n      this.ctx.globalCompositeOperation = 'source-in';\r\n      this.ctx.drawImage(\r\n        this.anotherCanvas,\r\n        0,\r\n        0,\r\n        this.canvas.width,\r\n        this.canvas.height\r\n      );\r\n    }\r\n    this.ctx.restore();\r\n\r\n    // 执行渲染后的回调\r\n    if (this.afterRender)\r\n      this.afterRender(this.ctx, this.progress, this.animState);\r\n\r\n    // 执行下一帧\r\n    if (this.animation) requestAnimationFrame(() => this._render());\r\n  }\r\n\r\n  _play() {\r\n    // 创建动画任务\r\n    if (!this.animation)\r\n      this.animation = requestAnimationFrame(() => this._render());\r\n  }\r\n\r\n  goto(progress) {\r\n    if (this.pauseAt !== undefined) this.pauseAt = undefined;\r\n    this.startTime = Date.now() - progress;\r\n    if (!this.animation) this._render();\r\n  }\r\n\r\n  play() {\r\n    if (!this.startTime) this.startTime = Date.now();\r\n    if (this.pauseAt !== undefined) {\r\n      this.goto(this.pauseAt);\r\n      this.pauseAt = undefined;\r\n    }\r\n    this._play();\r\n  }\r\n\r\n  replay() {\r\n    this.startTime = Date.now();\r\n    if (this.pauseAt !== undefined) this.pauseAt = undefined;\r\n    this._play();\r\n  }\r\n\r\n  pause() {\r\n    if (this.animation) {\r\n      cancelAnimationFrame(this.animation);\r\n      this.animation = undefined;\r\n\r\n      // 保存暂停时的进度\r\n      this.pauseAt = Date.now() - this.startTime;\r\n    }\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/Barrage/index.js","export const loadImage = url => {\r\n  const picture = new Image();\r\n  picture.src = url;\r\n\r\n  return new Promise((resolve, reject) => {\r\n    picture.onload = () => {\r\n      resolve(picture);\r\n    };\r\n    picture.onerror = () => {\r\n      reject();\r\n    };\r\n  });\r\n};\r\n\r\nexport const getImageData = (url, renderWidth, renderHeight, dx, dy, dw, dh) =>\r\n  loadImage(url).then(picture => {\r\n    const imgViewer = document.createElement('canvas');\r\n    imgViewer.width = renderWidth || picture.width;\r\n    imgViewer.height = renderHeight || picture.height;\r\n    const context = imgViewer.getContext('2d');\r\n\r\n    context.drawImage(picture, 0, 0, imgViewer.width, imgViewer.height);\r\n    return context.getImageData(\r\n      dx || 0,\r\n      dy || 0,\r\n      dw || imgViewer.width,\r\n      dh || imgViewer.height\r\n    );\r\n  });\r\n\r\nexport const requestAnimationFrame =\r\n  window.requestAnimationFrame ||\r\n  window.mozRequestAnimationFrame ||\r\n  window.webkitRequestAnimationFrame ||\r\n  window.msRequestAnimationFrame;\r\n\r\nexport const cancelAnimationFrame =\r\n  window.cancelAnimationFrame || window.mozCancelAnimationFrame;\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/Barrage/utils.js","import example from './example.json';\r\n\r\nconst randomKey = () =>\r\n  new Array(2)\r\n    .fill(0)\r\n    .map(() =>\r\n      Math.random()\r\n        .toString(32)\r\n        .slice(2)\r\n    )\r\n    .join('');\r\n\r\nconst colors = ['#f00', '#0f0', '#ff0', '#fff', '#fff', '#fff', '#fff'];\r\nconst randomColor = () => colors[Math.floor(6 * Math.random())];\r\n\r\nconst randomText = () =>\r\n  example[Math.floor(example.length * Math.random())].text;\r\n\r\nconst createdStart = Date.now();\r\n\r\nconst database = new Array(5000).fill(null).map((d, i) => ({\r\n  key: randomKey(),\r\n  time: 200 * (i + Math.random()),\r\n  text: randomText(),\r\n  color: randomColor(),\r\n  createdAt: createdStart + Math.random() * 24 * 3600 * 1000,\r\n}));\r\n\r\nexport default database;\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/containers/MaskingDanmakuDemo/mockData.js","module.exports = [{\"key\":\"7g43mm0rpp1l67eh6qjo8\",\"time\":500,\"text\":\"绿色走一波\",\"color\":\"#0f0\",\"createdAt\":\"2019-01-13T13:34:47.126Z\"},{\"key\":\"n8alq5l22d8qqbuhgst68g\",\"time\":1200,\"text\":\"我膨胀了\",\"fontFamily\":\"SimSun\",\"fontSize\":32,\"color\":\"yellow\",\"createdAt\":\"2019-01-13T13:34:47.126Z\"},{\"key\":\"atb8ctt81egh8hf45u7n2g\",\"time\":2500,\"text\":\"妈妈咪呀\",\"createdAt\":\"2019-01-13T13:34:47.126Z\"},{\"key\":\"bl9a602defoehsiahgi7vo\",\"time\":3300,\"text\":\"富贵使我们相遇\",\"createdAt\":\"2019-01-13T13:34:47.126Z\"},{\"key\":\"p0su7gh4s88fjtqv0bmdog\",\"time\":4000,\"text\":\"要想生活过得去\",\"color\":\"#0f0\",\"createdAt\":\"2019-01-13T13:34:47.126Z\"},{\"key\":\"udfel3ppv5ggrfqo4nlbng\",\"time\":4400,\"text\":\"你且在这里不要走动，待我去买两斤橘子\",\"color\":\"#f00\",\"createdAt\":\"2019-01-13T13:34:47.126Z\"},{\"key\":\"68ts93rle7gtv1i9die5ig\",\"time\":4800,\"text\":\"我们都一样\",\"createdAt\":\"2019-01-13T13:34:47.126Z\"},{\"key\":\"dcprmrcmdcg4btqej0mung\",\"time\":5200,\"text\":\"Remember me\",\"createdAt\":\"2019-01-13T13:34:47.126Z\"},{\"key\":\"9jgn02iii6b8qmkq2v2hg\",\"time\":5680,\"text\":\"LoL\",\"createdAt\":\"2019-01-13T13:34:47.126Z\"},{\"key\":\"im73i1lka0ooavb86gb048\",\"time\":6600,\"text\":\"(-_-)|||\",\"createdAt\":\"2019-01-13T13:34:47.126Z\"},{\"key\":\"hrbvbcuekoqm7aacufgk8\",\"time\":7200,\"text\":\"天哪噜\",\"createdAt\":\"2019-01-13T13:34:47.126Z\"},{\"key\":\"f95vsgh50qob6ip3r617b\",\"time\":8300,\"text\":\"富强 民主 文明 和谐 自由 平等 公正 法治 爱国 敬业 诚信 友善\",\"color\":\"#f00\",\"createdAt\":\"2019-01-13T13:34:47.126Z\"},{\"key\":\"u7bo393jvv8dkccb2ml0e\",\"time\":9210,\"text\":\"啦啦啦啦啦啦啦拉\",\"createdAt\":\"2019-01-13T13:34:47.126Z\"},{\"key\":\"muafgllnsg20op35brg9\",\"time\":10000,\"text\":\"我是谁 我从哪里来 我为什么要看这个\",\"createdAt\":\"2019-01-13T13:34:47.126Z\"},{\"key\":\"hjv3sllm12tbh85r2qor8\",\"time\":12000,\"text\":\"2333333333333333\",\"createdAt\":\"2019-01-13T13:34:47.126Z\"},{\"key\":\"r7u5mvu1l7g1hk7cvnddig\",\"time\":12000,\"text\":\"2333333333333333\",\"createdAt\":\"2019-01-13T13:34:47.126Z\"},{\"key\":\"0o51j9psnj8qn3bnfq9kag\",\"time\":12000,\"text\":\"2333333333333333\",\"createdAt\":\"2019-01-13T13:34:47.126Z\"},{\"key\":\"fkgm2nerakgr71jloi9d38\",\"time\":12000,\"text\":\"2333333333333333\",\"createdAt\":\"2019-01-13T13:34:47.126Z\"}]\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/containers/MaskingDanmakuDemo/example.json\n// module id = 1796\n// module chunks = 3","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../node_modules/css-loader/index.js??ref--1-oneOf-2-2!../../../node_modules/postcss-loader/lib/index.js??postcss!./style.css\");\nif(typeof content === 'string') content = [[module.id, content, '']];\n// Prepare cssTransformation\nvar transform;\n\nvar options = {}\noptions.transform = transform\n// add the styles to the DOM\nvar update = require(\"!../../../node_modules/style-loader/lib/addStyles.js\")(content, options);\nif(content.locals) module.exports = content.locals;\n// Hot Module Replacement\nif(module.hot) {\n\t// When the styles change, update the <style> tags\n\tif(!content.locals) {\n\t\tmodule.hot.accept(\"!!../../../node_modules/css-loader/index.js??ref--1-oneOf-2-2!../../../node_modules/postcss-loader/lib/index.js??postcss!./style.css\", function() {\n\t\t\tvar newContent = require(\"!!../../../node_modules/css-loader/index.js??ref--1-oneOf-2-2!../../../node_modules/postcss-loader/lib/index.js??postcss!./style.css\");\n\t\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\t\t\tupdate(newContent);\n\t\t});\n\t}\n\t// When the module is disposed, remove the <style> tags\n\tmodule.hot.dispose(function() { update(); });\n}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/containers/MaskingDanmakuDemo/style.css\n// module id = 1797\n// module chunks = 3","exports = module.exports = require(\"../../../node_modules/css-loader/lib/css-base.js\")(true);\n// imports\n\n\n// module\nexports.push([module.id, \".danmaku-container,.danmaku-video{width:880px;height:540px}.danmaku-container{margin:0 auto;margin-top:50vh;margin-left:50vw;-webkit-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);transform:translate(-50%,-50%);background-color:#ddd}.danmaku-video::-webkit-media-controls-fullscreen-button{display:none}\", \"\", {\"version\":3,\"sources\":[\"E:/GitHub/Blog/src/containers/MaskingDanmakuDemo/style.css\"],\"names\":[],\"mappings\":\"AAAA,kCAEE,YAAa,AACb,YAAc,CACf,AAED,mBACE,cAAe,AACf,gBAAiB,AACjB,iBAAkB,AAClB,uCAAyC,AACrC,mCAAqC,AACjC,+BAAiC,AACzC,qBAAuB,CACxB,AAED,yDACE,YAAc,CACf\",\"file\":\"style.css\",\"sourcesContent\":[\".danmaku-container,\\r\\n.danmaku-video {\\r\\n  width: 880px;\\r\\n  height: 540px;\\r\\n}\\r\\n\\r\\n.danmaku-container {\\r\\n  margin: 0 auto;\\r\\n  margin-top: 50vh;\\r\\n  margin-left: 50vw;\\r\\n  -webkit-transform: translate(-50%, -50%);\\r\\n      -ms-transform: translate(-50%, -50%);\\r\\n          transform: translate(-50%, -50%);\\r\\n  background-color: #ddd;\\r\\n}\\r\\n\\r\\n.danmaku-video::-webkit-media-controls-fullscreen-button {\\r\\n  display: none;\\r\\n}\\r\\n\"],\"sourceRoot\":\"\"}]);\n\n// exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/css-loader?{\"importLoaders\":1,\"minimize\":true,\"sourceMap\":true}!./node_modules/postcss-loader/lib?{\"ident\":\"postcss\",\"plugins\":[null,null]}!./src/containers/MaskingDanmakuDemo/style.css\n// module id = 1798\n// module chunks = 3","import React, { Component } from 'react';\r\nimport Barrage from 'components/Barrage';\r\nimport data from './mockData';\r\nimport './style.css';\r\n\r\nconst videoSize = {\r\n  width: 880,\r\n  height: 540,\r\n};\r\n\r\nexport default class MaskingDanmakuDemo extends Component {\r\n  componentDidMount() {\r\n    // 创建弹幕实例\r\n    const barrage = new Barrage({\r\n      container: this.container,\r\n      config: {\r\n        overlapOptimized: true,\r\n      },\r\n    });\r\n\r\n    // 重置画布高度，避免弹幕遮挡视频播放控件\r\n    barrage.canvas.width = videoSize.width;\r\n    barrage.canvas.height = videoSize.height - 80;\r\n    barrage.setData(data);\r\n\r\n    // 新建一个画布来实时绘制视频（纯绘图，不用添加进页面）\r\n    const vCanvas = document.createElement('canvas');\r\n    vCanvas.width = videoSize.width;\r\n    vCanvas.height = videoSize.height;\r\n    const vContext = vCanvas.getContext('2d');\r\n\r\n    // 实时绘制视频到画布\r\n    barrage.afterRender = () => {\r\n      vContext.drawImage(this.video, 0, 0, vCanvas.width, vCanvas.height);\r\n    };\r\n\r\n    // 渲染前读取画布 vCanvas 的数据，并处理为蒙版图像\r\n    barrage.beforeRender = () => {\r\n      // 读取图像\r\n      const frame = vContext.getImageData(0, 0, vCanvas.width, vCanvas.height);\r\n\r\n      // 图像总像素个数\r\n      const pxCount = frame.data.length / 4;\r\n\r\n      // 将 frame 构造成我们需要的蒙版图像\r\n      for (let i = 0; i < pxCount; i++) {\r\n        // 这里不用 ES6 解构赋值的写法，主要为了保证计算性能\r\n        const r = frame.data[i * 4 + 0];\r\n        const g = frame.data[i * 4 + 1];\r\n        const b = frame.data[i * 4 + 2];\r\n\r\n        // 将黑色区域以外的内容设为透明\r\n        if (r > 15 || g > 15 || b > 15) {\r\n          frame.data[4 * i + 3] = 0;\r\n        }\r\n      }\r\n\r\n      // 设置蒙版\r\n      barrage.setMask(frame);\r\n    };\r\n\r\n    // 绑定播放事件\r\n    this.video.addEventListener(\r\n      'play',\r\n      () => {\r\n        barrage.play();\r\n      },\r\n      false\r\n    );\r\n\r\n    // 绑定暂停事件\r\n    this.video.addEventListener(\r\n      'pause',\r\n      () => {\r\n        barrage.pause();\r\n      },\r\n      false\r\n    );\r\n\r\n    // 播放进度事件\r\n    this.video.addEventListener(\r\n      'seeked',\r\n      () => {\r\n        barrage.goto(this.video.currentTime * 1000);\r\n      },\r\n      false\r\n    );\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div\r\n        className=\"danmaku-container\"\r\n        ref={ref => {\r\n          this.container = ref;\r\n        }}>\r\n        <video\r\n          className=\"danmaku-video\"\r\n          ref={ref => {\r\n            this.video = ref;\r\n          }}\r\n          src=\"videos/demo.mp4\"\r\n          controls\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/containers/MaskingDanmakuDemo/index.js"],"sourceRoot":""}